<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª - ÙŠØ¹Ù…Ù„ 100%</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .table th {
            border-top: none;
            font-weight: 600;
            background-color: #f8f9fa;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .product-card {
            transition: transform 0.2s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#" onclick="showPage('home')">
                <i class="fas fa-car me-2"></i>
                Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª - ÙŠØ¹Ù…Ù„ 100%
            </a>
            
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" onclick="showPage('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a class="nav-link" href="#" onclick="showPage('shops')">Ø§Ù„Ù…Ø­Ù„Ø§Øª</a>
                <a class="nav-link" href="#" onclick="resetData()" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                    <i class="fas fa-redo text-warning"></i>
                </a>
                <a class="nav-link" href="#" onclick="showPage('login')" id="loginLink">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                <a class="nav-link" href="#" onclick="logout()" id="logoutLink" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
                <a class="nav-link" href="#" onclick="showPage('dashboard')" id="dashboardLink" style="display: none;"></a>
                <span class="nav-link" id="userWelcome" style="display: none;"></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-section text-center" id="heroSection">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">ğŸš— ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h1>
            <p class="lead mb-4">ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹Ù…Ù„ 100% Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù!</p>
            <div class="alert alert-light d-inline-block">
                <h5><i class="fas fa-check-circle me-2 text-success"></i>ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ</h5>
                <p class="mb-0">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù ØªØ¹Ù…Ù„ - Ø¥Ø¶Ø§ÙØ©ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø­Ø°ÙØŒ Ø­ÙØ¸ Ø¯Ø§Ø¦Ù…</p>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Home Page -->
        <div id="home" class="page-content active">
            <!-- Search Section -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-search me-2"></i>
                        Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Search Instructions -->
                    <div class="alert alert-info mb-3">
                        <h6><i class="fas fa-info-circle me-2"></i>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø­Ø«</h6>
                        <p class="mb-2 small">
                            <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙƒÙ„ Ù†ÙˆØ¹ Ø¨Ø­Ø« ÙŠØ¹Ù…Ù„ Ù…Ù†ÙØµÙ„Ø§Ù‹ - Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙˆØ¹ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        </p>
                        <div class="btn-group btn-group-sm mb-2" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="testCarBrandSearchManual('ØªÙˆÙŠÙˆØªØ§')">
                                Ø§Ø®ØªØ¨Ø§Ø± ØªÙˆÙŠÙˆØªØ§
                            </button>
                            <button type="button" class="btn btn-outline-success" onclick="testCarBrandSearchManual('Ù‡ÙˆÙ†Ø¯Ø§')">
                                Ø§Ø®ØªØ¨Ø§Ø± Ù‡ÙˆÙ†Ø¯Ø§
                            </button>
                            <button type="button" class="btn btn-outline-warning" onclick="testCarBrandSearchManual('Ù†ÙŠØ³Ø§Ù†')">
                                Ø§Ø®ØªØ¨Ø§Ø± Ù†ÙŠØ³Ø§Ù†
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="loadSearchCarBrands()">
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
                            </button>
                        </div>
                        <div class="btn-group btn-group-sm mb-2" role="group">
                            <button type="button" class="btn btn-outline-secondary" onclick="testCarYearSearchManual('2015')">
                                Ø§Ø®ØªØ¨Ø§Ø± 2015
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="testCarYearSearchManual('2018')">
                                Ø§Ø®ØªØ¨Ø§Ø± 2018
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="testCarYearSearchManual('2020')">
                                Ø§Ø®ØªØ¨Ø§Ø± 2020
                            </button>
                            <button type="button" class="btn btn-outline-dark" onclick="testAllCarYears()">
                                Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
                            </button>
                        </div>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-success" onclick="showProductAnalysis()">
                                ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="loadSearchCarYears()">
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
                            </button>
                        </div>
                    </div>

                    <!-- First Row - Text Search and Category -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="clearOtherSearches('text'); performSearch()">
                                <label for="searchInput">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ (Ø§Ø³Ù…ØŒ ÙˆØµÙ)</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="partNumberSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©..." onkeyup="clearOtherSearches('partNumber'); performSearch()">
                                <label for="partNumberSearch">ğŸ·ï¸ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© / ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù</label>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="categoryFilter" onchange="clearOtherSearches('category'); performSearch()">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                                </select>
                                <label for="categoryFilter">ğŸ“‚ ÙØ¦Ø© Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                            </div>
                        </div>
                    </div>

                    <!-- Second Row - Car Information -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="carBrandSearch" onchange="clearOtherSearches('car'); updateSearchCarModels(); performSearch()">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
                                </select>
                                <label for="carBrandSearch">ğŸš— Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="carModelSearch" onchange="clearOtherSearches('car'); performSearch()">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</option>
                                </select>
                                <label for="carModelSearch">ğŸ·ï¸ Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-floating mb-3">
                                <select class="form-select" id="carYearSearch" onchange="clearOtherSearches('car'); performSearch()">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</option>
                                </select>
                                <label for="carYearSearch">ğŸ“… Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø§Ù„Ø³Ù†Ø©)</label>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group w-100 h-100" role="group">
                                <button class="btn btn-primary" onclick="performSearch()" title="Ø¨Ø­Ø«">
                                    <i class="fas fa-search me-1"></i>
                                    Ø¨Ø­Ø«
                                </button>
                                <button class="btn btn-outline-secondary" onclick="clearAllSearches()" title="Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª">
                                    <i class="fas fa-times me-1"></i>
                                    Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <span id="searchResults" class="text-muted small"></span>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-outline-info btn-sm me-1" onclick="showAllCategories()">
                                <i class="fas fa-tags me-1"></i>
                                Ø§Ù„ÙØ¦Ø§Øª
                            </button>
                            <button class="btn btn-outline-success btn-sm me-1" onclick="showAllBrands()">
                                <i class="fas fa-car me-1"></i>
                                Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="showAllModels()">
                                <i class="fas fa-cogs me-1"></i>
                                Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Categories Overview -->
            <div class="card mb-4" id="categoriesCard">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-tags me-2"></i>
                        Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row" id="categoriesContainer">
                        <!-- Ø§Ù„ÙØ¦Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>

            <!-- Brands Overview -->
            <div class="card mb-4" id="brandsCard" style="display: none;">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-car me-2"></i>
                        Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row" id="brandsContainer">
                        <!-- Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>

            <!-- Models Overview -->
            <div class="card mb-4" id="modelsCard" style="display: none;">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>
                        Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row" id="modelsContainer">
                        <!-- Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>

            <!-- Products Table -->
            <div class="card">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-table me-2"></i>
                        Ø¬Ø¯ÙˆÙ„ Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø± ÙˆØ§Ù„Ù…Ø­Ù„Ø§Øª
                    </h5>
                    <div>
                        <span class="badge bg-success me-2" id="dataStatus">
                            <i class="fas fa-save me-1"></i>
                            Ù…Ø­ÙÙˆØ¸
                        </span>
                        <span class="badge bg-info me-2" id="lastUpdate">
                            <i class="fas fa-clock me-1"></i>
                            <span id="updateTime">Ø§Ù„Ø¢Ù†</span>
                        </span>
                        <button class="btn btn-light btn-sm" onclick="forceRefreshData()" title="ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª">
                            <i class="fas fa-sync-alt me-1"></i>
                            ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ
                        </button>
                        <button class="btn btn-outline-primary btn-sm ms-1" onclick="autoRefreshData()" title="ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ">
                            <i class="fas fa-refresh me-1"></i>
                            ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Ø§Ø³Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
                                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                    <th>Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                    <th>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                    <th>Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</th>
                                    <th>Ø£Ù‚Ù„ Ø³Ø¹Ø±</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØ­Ù…Ù„ Ù‡Ù†Ø§ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row">
                <div class="col-md-3">
                    <div class="card bg-primary text-white text-center">
                        <div class="card-body">
                            <h4 id="totalProducts">0</h4>
                            <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø·Ø¹</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white text-center">
                        <div class="card-body">
                            <h4 id="totalShops">0</h4>
                            <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white text-center">
                        <div class="card-body">
                            <h4 id="totalQuantity">0</h4>
                            <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white text-center">
                        <div class="card-body">
                            <h4 id="averagePrice">0 Ø±ÙŠØ§Ù„</h4>
                            <p class="mb-0">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shops Page -->
        <div id="shops" class="page-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ù„Ø§Øª</h2>
                <div>
                    <button class="btn btn-success" onclick="showAddShopModal()" id="addShopBtn">
                        <i class="fas fa-plus me-2"></i>
                        Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯
                    </button>
                    <button class="btn btn-outline-info ms-2" onclick="loadShops()">
                        <i class="fas fa-sync-alt me-2"></i>
                        ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
            </div>
            
            <div class="row" id="shopsContainer">
                <!-- Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>

        <!-- Login Page -->
        <div id="login" class="page-content">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-primary text-white text-center">
                            <h4 class="mb-0">
                                <i class="fas fa-sign-in-alt me-2"></i>
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                            </h4>
                        </div>
                        <div class="card-body">
                            <form id="loginForm">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
                                    <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <input type="password" class="form-control" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                                    <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-100 mb-3">
                                    <i class="fas fa-sign-in-alt me-2"></i>
                                    Ø¯Ø®ÙˆÙ„
                                </button>
                                
                                <div id="loginAlert" class="alert" style="display: none;"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard" class="page-content">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                            <h2 class="mb-3" id="dashboardTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                            <p class="lead mb-0" id="dashboardMessage">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card bg-success text-white text-center">
                        <div class="card-body">
                            <h3 id="dashboardProducts">0</h3>
                            <p class="mb-0">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-info text-white text-center">
                        <div class="card-body">
                            <h3 id="dashboardShops">0</h3>
                            <p class="mb-0">Ø§Ù„Ù…Ø­Ù„Ø§Øª</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-warning text-white text-center">
                        <div class="card-body">
                            <h3 id="dashboardValue">0</h3>
                            <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h5>
                    <button class="btn btn-success" onclick="showAddProductModal()">
                        <i class="fas fa-plus me-2"></i>
                        Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                <div class="card-body">
                    <div class="row" id="dashboardProductsContainer">
                        <!-- Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ù„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals will be added here -->
    <div id="modalsContainer"></div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let currentUser = null;
        let nextShopId = 2;
        let nextProductId = 5;

        // Default data
        const defaultUsers = {
            'admin': { password: 'admin123', role: 'admin', name: 'Ø§Ù„Ù…Ø¯ÙŠØ±' },
            'shop1': { password: 'shop123', role: 'shop', name: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1 }
        };

        const defaultShops = [
            {
                id: 1,
                name: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª',
                description: 'Ù…Ø­Ù„ Ù…ØªØ®ØµØµ ÙÙŠ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ© ÙˆØ§Ù„ÙƒÙˆØ±ÙŠØ©',
                phone: '+966501234567',
                email: 'alaseel@example.com',
                address: 'Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶',
                city: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                specialty: 'Ù‚Ø·Ø¹ ØºÙŠØ§Ø± ÙŠØ§Ø¨Ø§Ù†ÙŠØ©',
                rating: 4.5,
                joinDate: '2024-01-01'
            }
        ];

        const defaultProducts = [
            {
                id: 1,
                name: 'ÙÙ„ØªØ± Ù‡ÙˆØ§Ø¡ ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ 2015',
                description: 'ÙÙ„ØªØ± Ù‡ÙˆØ§Ø¡ Ø£ØµÙ„ÙŠ Ù„Ø³ÙŠØ§Ø±Ø© ØªÙˆÙŠÙˆØªØ§ ÙƒØ§Ù…Ø±ÙŠ Ù…ÙˆØ¯ÙŠÙ„ 2015',
                partNumber: 'TOY-AF-001',
                category: 'ÙÙ„Ø§ØªØ±',
                brand: 'ØªÙˆÙŠÙˆØªØ§',
                model: 'ÙƒØ§Ù…Ø±ÙŠ 2015',
                shopDetails: [{ shopName: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1, price: 85.0, quantity: 15 }]
            },
            {
                id: 2,
                name: 'ØªÙŠÙ„ ÙØ±Ø§Ù…Ù„ Ù‡ÙˆÙ†Ø¯Ø§ Ø£ÙƒÙˆØ±Ø¯ 2018',
                description: 'ØªÙŠÙ„ ÙØ±Ø§Ù…Ù„ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„Ø³ÙŠØ§Ø±Ø© Ù‡ÙˆÙ†Ø¯Ø§ Ø£ÙƒÙˆØ±Ø¯ Ù…ÙˆØ¯ÙŠÙ„ 2018',
                partNumber: 'HON-BP-002',
                category: 'ÙØ±Ø§Ù…Ù„',
                brand: 'Ù‡ÙˆÙ†Ø¯Ø§',
                model: 'Ø£ÙƒÙˆØ±Ø¯ 2018',
                shopDetails: [{ shopName: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1, price: 120.0, quantity: 8 }]
            },
            {
                id: 3,
                name: 'Ø²ÙŠØª Ù…Ø­Ø±Ùƒ Ù…ÙˆØ¨ÙŠÙ„ 1',
                description: 'Ø²ÙŠØª Ù…Ø­Ø±Ùƒ ØµÙ†Ø§Ø¹ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª',
                partNumber: 'MOB-OIL-003',
                category: 'Ø²ÙŠÙˆØª',
                brand: 'Ù…ÙˆØ¨ÙŠÙ„',
                model: 'Ø¹Ø§Ù…',
                shopDetails: [{ shopName: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1, price: 95.0, quantity: 25 }]
            },
            {
                id: 4,
                name: 'Ø¨Ø·Ø§Ø±ÙŠØ© Ù†ÙŠØ³Ø§Ù† Ø§Ù„ØªÙŠÙ…Ø§ 2020',
                description: 'Ø¨Ø·Ø§Ø±ÙŠØ© Ø£ØµÙ„ÙŠØ© Ù„Ø³ÙŠØ§Ø±Ø© Ù†ÙŠØ³Ø§Ù† Ø§Ù„ØªÙŠÙ…Ø§ Ù…ÙˆØ¯ÙŠÙ„ 2020',
                partNumber: 'NIS-BAT-004',
                category: 'ÙƒÙ‡Ø±Ø¨Ø§Ø¡',
                brand: 'Ù†ÙŠØ³Ø§Ù†',
                model: 'Ø§Ù„ØªÙŠÙ…Ø§ 2020',
                shopDetails: [{ shopName: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1, price: 280.0, quantity: 5 }]
            },
            {
                id: 5,
                name: 'ÙÙ„ØªØ± Ø²ÙŠØª ØªÙˆÙŠÙˆØªØ§ ÙŠØ§Ø±Ø³ 2017',
                description: 'ÙÙ„ØªØ± Ø²ÙŠØª Ø£ØµÙ„ÙŠ Ù„Ø³ÙŠØ§Ø±Ø© ØªÙˆÙŠÙˆØªØ§ ÙŠØ§Ø±Ø³ Ù…ÙˆØ¯ÙŠÙ„ 2017',
                partNumber: 'TOY-OF-005',
                category: 'ÙÙ„Ø§ØªØ±',
                brand: 'ØªÙˆÙŠÙˆØªØ§',
                model: 'ÙŠØ§Ø±Ø³ 2017',
                shopDetails: [{ shopName: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1, price: 35.0, quantity: 20 }]
            },
            {
                id: 6,
                name: 'Ø¥Ø·Ø§Ø± Ù…ÙŠØ´Ù„Ø§Ù† Ù‡ÙˆÙ†Ø¯Ø§ Ø³ÙŠÙÙŠÙƒ 2019',
                description: 'Ø¥Ø·Ø§Ø± Ù…ÙŠØ´Ù„Ø§Ù† Ù…Ù‚Ø§Ø³ 195/65R15 Ù„Ù‡ÙˆÙ†Ø¯Ø§ Ø³ÙŠÙÙŠÙƒ 2019',
                partNumber: 'MIC-TIR-006',
                category: 'Ø¥Ø·Ø§Ø±Ø§Øª',
                brand: 'Ù‡ÙˆÙ†Ø¯Ø§',
                model: 'Ø³ÙŠÙÙŠÙƒ 2019',
                shopDetails: [{ shopName: 'Ù…Ø­Ù„ Ø§Ù„Ø£ØµÙŠÙ„ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', shopId: 1, price: 320.0, quantity: 12 }]
            }
        ];

        // Working data (loaded from localStorage or defaults)
        let users = {};
        let shops = [];
        let products = [];

        // LocalStorage functions
        function saveToStorage() {
            try {
                localStorage.setItem('autoparts_users', JSON.stringify(users));
                localStorage.setItem('autoparts_shops', JSON.stringify(shops));
                localStorage.setItem('autoparts_products', JSON.stringify(products));
                localStorage.setItem('autoparts_nextShopId', nextShopId.toString());
                localStorage.setItem('autoparts_nextProductId', nextProductId.toString());

                // Update status indicator
                const statusElement = document.getElementById('dataStatus');
                if (statusElement) {
                    statusElement.className = 'badge bg-success me-2';
                    statusElement.innerHTML = '<i class="fas fa-save me-1"></i>Ù…Ø­ÙÙˆØ¸';
                }

                // Update last update time
                updateLastUpdateTime();

                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage');
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
            }
        }

        function loadFromStorage() {
            try {
                const savedUsers = localStorage.getItem('autoparts_users');
                const savedShops = localStorage.getItem('autoparts_shops');
                const savedProducts = localStorage.getItem('autoparts_products');
                const savedNextShopId = localStorage.getItem('autoparts_nextShopId');
                const savedNextProductId = localStorage.getItem('autoparts_nextProductId');

                if (savedUsers && savedShops && savedProducts) {
                    users = JSON.parse(savedUsers);
                    shops = JSON.parse(savedShops);
                    products = JSON.parse(savedProducts);
                    nextShopId = savedNextShopId ? parseInt(savedNextShopId) : 2;
                    nextProductId = savedNextProductId ? parseInt(savedNextProductId) : 5;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage');
                    return true;
                } else {
                    console.log('ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                    return false;
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                return false;
            }
        }

        function initializeData() {
            const dataLoaded = loadFromStorage();

            if (!dataLoaded) {
                // Use default data
                users = { ...defaultUsers };
                shops = [...defaultShops];
                products = [...defaultProducts];

                // Save initial data
                saveToStorage();
                console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
            }
        }

        function resetData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª!')) {
                localStorage.removeItem('autoparts_users');
                localStorage.removeItem('autoparts_shops');
                localStorage.removeItem('autoparts_products');
                localStorage.removeItem('autoparts_nextShopId');
                localStorage.removeItem('autoparts_nextProductId');

                // Reset to defaults
                users = { ...defaultUsers };
                shops = [...defaultShops];
                products = [...defaultProducts];
                nextShopId = 2;
                nextProductId = 5;

                saveToStorage();
                showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');

                // Refresh current page
                if (document.getElementById('home').classList.contains('active')) {
                    loadData();
                } else if (document.getElementById('shops').classList.contains('active')) {
                    loadShops();
                } else if (document.getElementById('dashboard').classList.contains('active')) {
                    loadDashboard();
                }
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} notification`;
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;

            container.appendChild(notification);

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Hide notification after 4 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Show page
        function showPage(pageId) {
            console.log(`ğŸ“„ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© Ø¥Ù„Ù‰: ${pageId}`);

            // Hide hero section for other pages
            const heroSection = document.getElementById('heroSection');
            if (pageId !== 'home') {
                heroSection.style.display = 'none';
            } else {
                heroSection.style.display = 'block';
            }

            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });

            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Refresh data from localStorage before loading content
            loadFromStorage();

            // Load content based on page with immediate refresh
            setTimeout(() => {
                if (pageId === 'home') {
                    loadData();
                    console.log('ğŸ  ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
                } else if (pageId === 'shops') {
                    loadShops();
                    console.log('ğŸª ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª');
                } else if (pageId === 'dashboard') {
                    loadDashboard();
                    console.log('ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
                }
            }, 50);
        }

        // Load data
        function loadData() {
            console.log('ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
            console.log('ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:', products.length);

            // Ensure products are loaded
            if (products.length === 0) {
                console.log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§ØªØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©...');
                loadFromStorage();
            }

            displayProducts(products);
            loadCategories();
            loadBrands();
            loadModels();

            // Load car search data with delay to ensure DOM is ready
            setTimeout(() => {
                loadSearchCarBrands();
                loadSearchCarYears();
                updateSearchCarModels();
            }, 100);

            updateSummaryCards();

            // Clear any existing search
            clearAllSearches();

            showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Display products (with optional filtering)
        function displayProducts(productsToShow) {
            const tableBody = document.getElementById('productsTableBody');
            tableBody.innerHTML = '';

            if (productsToShow.length === 0) {
                const isSearchActive = document.getElementById('searchInput').value.trim() ||
                                     document.getElementById('categoryFilter').value ||
                                     (document.getElementById('partNumberSearch') && document.getElementById('partNumberSearch').value.trim()) ||
                                     (document.getElementById('carBrandSearch') && document.getElementById('carBrandSearch').value) ||
                                     (document.getElementById('carModelSearch') && document.getElementById('carModelSearch').value) ||
                                     (document.getElementById('carYearSearch') && document.getElementById('carYearSearch').value);

                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <div class="alert ${isSearchActive ? 'alert-warning' : 'alert-info'} mb-0">
                                <i class="fas fa-${isSearchActive ? 'search' : 'info-circle'} me-2"></i>
                                ${isSearchActive ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª'}
                                ${isSearchActive ? `
                                    <br>
                                    <button class="btn btn-outline-primary btn-sm mt-2" onclick="clearSearch()">
                                        <i class="fas fa-times me-1"></i>
                                        Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            productsToShow.forEach(product => {
                const prices = product.shopDetails.map(shop => shop.price);
                const minPrice = Math.min(...prices);
                const totalQuantity = product.shopDetails.reduce((sum, shop) => sum + shop.quantity, 0);

                const shopsList = product.shopDetails.map(shopDetail => {
                    return `
                        <div class="d-flex justify-content-between align-items-center mb-1 p-2 border rounded bg-light">
                            <div class="flex-grow-1">
                                <div class="fw-bold text-primary" style="font-size: 0.9rem;">${shopDetail.shopName}</div>
                                <div class="d-flex justify-content-between align-items-center mt-1">
                                    <span class="badge bg-success">${shopDetail.price} Ø±ÙŠØ§Ù„</span>
                                    <span class="badge bg-info">Ø§Ù„ÙƒÙ…ÙŠØ©: ${shopDetail.quantity}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Extract car information from product
                const carBrand = product.brand || '-';
                let carModel = '-';
                let carYear = '-';

                if (product.model && product.model.trim()) {
                    const modelText = product.model.trim();
                    // Try to extract year from model
                    const yearMatch = modelText.match(/\d{4}/);
                    if (yearMatch) {
                        carYear = yearMatch[0];
                        carModel = modelText.replace(/\s*\d{4}\s*/, '').trim() || '-';
                    } else {
                        carModel = modelText;
                    }
                }

                const row = `
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <div style="width: 40px; height: 40px; background: #f8f9fa; border-radius: 5px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-cog text-muted"></i>
                                    </div>
                                </div>
                                <div>
                                    <strong>${product.name}</strong>
                                    ${product.category ? `<br><span class="badge bg-secondary badge-sm">${product.category}</span>` : ''}
                                </div>
                            </div>
                        </td>
                        <td>
                            <code class="text-primary">${product.partNumber || '-'}</code>
                        </td>
                        <td>
                            <div class="text-center">
                                ${carBrand !== '-' ? `
                                    <span class="badge bg-primary">${carBrand}</span>
                                ` : `
                                    <span class="text-muted">-</span>
                                `}
                            </div>
                        </td>
                        <td>
                            <div class="text-center">
                                ${carModel !== '-' ? `
                                    <span class="badge bg-info">${carModel}</span>
                                ` : `
                                    <span class="text-muted">-</span>
                                `}
                            </div>
                        </td>
                        <td>
                            <div class="text-center">
                                ${carYear !== '-' ? `
                                    <span class="badge bg-warning text-dark">${carYear}</span>
                                ` : `
                                    <span class="text-muted">-</span>
                                `}
                            </div>
                        </td>
                        <td>
                            <div style="max-height: 150px; overflow-y: auto;">
                                ${shopsList}
                            </div>
                            <small class="text-muted">
                                ${product.shopDetails.length} Ù…Ø­Ù„ |
                                Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©: <span class="fw-bold">${totalQuantity}</span>
                            </small>
                        </td>
                        <td>
                            <div class="text-center">
                                <span class="fw-bold text-success fs-6">${minPrice} Ø±ÙŠØ§Ù„</span>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group-vertical btn-group-sm">
                                <button class="btn btn-outline-primary btn-sm mb-1" onclick="showProductDetail(${product.id})" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${currentUser && currentUser.role === 'admin' ? `
                                    <button class="btn btn-outline-danger btn-sm" onclick="deleteProduct(${product.id})" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Load categories
        function loadCategories() {
            const categoryFilter = document.getElementById('categoryFilter');
            const categoriesContainer = document.getElementById('categoriesContainer');

            // Get unique categories
            const categories = {};
            products.forEach(product => {
                if (product.category) {
                    if (!categories[product.category]) {
                        categories[product.category] = {
                            name: product.category,
                            count: 0,
                            totalQuantity: 0,
                            avgPrice: 0,
                            products: []
                        };
                    }
                    categories[product.category].count++;
                    categories[product.category].products.push(product);

                    // Calculate total quantity and average price
                    product.shopDetails.forEach(shop => {
                        categories[product.category].totalQuantity += shop.quantity;
                        categories[product.category].avgPrice += shop.price;
                    });
                }
            });

            // Calculate average prices
            Object.keys(categories).forEach(categoryName => {
                const category = categories[categoryName];
                const totalPrices = category.products.reduce((sum, product) => {
                    return sum + product.shopDetails.reduce((pSum, shop) => pSum + shop.price, 0);
                }, 0);
                const totalShops = category.products.reduce((sum, product) => sum + product.shopDetails.length, 0);
                category.avgPrice = totalShops > 0 ? Math.round(totalPrices / totalShops) : 0;
            });

            // Update category filter dropdown
            categoryFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>';
            Object.keys(categories).sort().forEach(categoryName => {
                const option = document.createElement('option');
                option.value = categoryName;
                option.textContent = `${categoryName} (${categories[categoryName].count})`;
                categoryFilter.appendChild(option);
            });

            // Update categories display
            categoriesContainer.innerHTML = '';
            if (Object.keys(categories).length === 0) {
                categoriesContainer.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
                        </div>
                    </div>
                `;
                return;
            }

            Object.keys(categories).sort().forEach(categoryName => {
                const category = categories[categoryName];
                const categoryCard = `
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="card product-card h-100" style="cursor: pointer;" onclick="filterByCategory('${categoryName}')">
                            <div class="card-body text-center">
                                <div class="mb-2">
                                    <i class="fas fa-tag fa-2x text-primary"></i>
                                </div>
                                <h6 class="card-title text-primary">${categoryName}</h6>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <small class="text-muted">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</small>
                                        <div class="fw-bold text-success">${category.count}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Ø§Ù„ÙƒÙ…ÙŠØ©</small>
                                        <div class="fw-bold text-info">${category.totalQuantity}</div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</small>
                                    <div class="fw-bold text-warning">${category.avgPrice} Ø±ÙŠØ§Ù„</div>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="event.stopPropagation(); filterByCategory('${categoryName}')">
                                        <i class="fas fa-search me-1"></i>
                                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                categoriesContainer.innerHTML += categoryCard;
            });
        }

        // Load brands
        function loadBrands() {
            const brandFilter = document.getElementById('brandFilter');

            // Get unique brands
            const brands = {};
            products.forEach(product => {
                if (product.brand && product.brand.trim()) {
                    const brandName = product.brand.trim();
                    if (!brands[brandName]) {
                        brands[brandName] = {
                            name: brandName,
                            count: 0,
                            models: new Set()
                        };
                    }
                    brands[brandName].count++;
                    if (product.model && product.model.trim()) {
                        brands[brandName].models.add(product.model.trim());
                    }
                }
            });

            // Update brand filter dropdown
            brandFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</option>';
            Object.keys(brands).sort().forEach(brandName => {
                const brand = brands[brandName];
                const option = document.createElement('option');
                option.value = brandName;
                option.textContent = `${brandName} (${brand.count})`;
                brandFilter.appendChild(option);
            });
        }

        // Load models based on selected brand
        function loadModels() {
            const brandFilter = document.getElementById('brandFilter');
            const modelFilter = document.getElementById('modelFilter');
            const selectedBrand = brandFilter.value;

            // Clear models
            modelFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</option>';

            if (!selectedBrand) {
                // If no brand selected, show all models
                const allModels = new Set();
                products.forEach(product => {
                    if (product.model && product.model.trim()) {
                        allModels.add(product.model.trim());
                    }
                });

                Array.from(allModels).sort().forEach(modelName => {
                    const option = document.createElement('option');
                    option.value = modelName;
                    option.textContent = modelName;
                    modelFilter.appendChild(option);
                });
            } else {
                // Show models for selected brand
                const brandModels = new Set();
                products.forEach(product => {
                    if (product.brand === selectedBrand && product.model && product.model.trim()) {
                        brandModels.add(product.model.trim());
                    }
                });

                Array.from(brandModels).sort().forEach(modelName => {
                    const option = document.createElement('option');
                    option.value = modelName;
                    option.textContent = modelName;
                    modelFilter.appendChild(option);
                });
            }
        }

        // Load search car brands
        function loadSearchCarBrands() {
            console.log('ğŸš— ØªØ­Ù…ÙŠÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø¨Ø­Ø«...');
            const carBrandSearch = document.getElementById('carBrandSearch');
            if (!carBrandSearch) {
                console.log('âŒ Ø¹Ù†ØµØ± carBrandSearch ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            // Get unique car brands from products
            const carBrands = new Set();
            console.log('ğŸ“Š ÙØ­Øµ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª...');
            console.log('ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', products.length);

            products.forEach((product, index) => {
                console.log(`ğŸ“¦ Ù…Ù†ØªØ¬ ${index + 1}:`, {
                    name: product.name,
                    brand: product.brand,
                    model: product.model
                });

                if (product.brand && product.brand.trim()) {
                    // Include all brands, even Ù…ÙˆØ¨ÙŠÙ„ for testing
                    carBrands.add(product.brand.trim());
                    console.log('ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', product.brand.trim());
                }
            });

            // Add all available car brands from carModels
            console.log('ğŸ“‹ Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù† carModels...');
            Object.keys(carModels).forEach(brand => {
                carBrands.add(brand);
                console.log('ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ Ø³ÙŠØ§Ø±Ø© Ù…Ù† carModels:', brand);
            });

            // Update car brand search dropdown
            carBrandSearch.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>';
            const sortedBrands = Array.from(carBrands).sort();
            console.log('ğŸ“‹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø©:', sortedBrands);

            sortedBrands.forEach(brand => {
                const option = document.createElement('option');
                option.value = brand;
                option.textContent = brand;
                carBrandSearch.appendChild(option);
                console.log(`â• Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±: ${brand}`);
            });

            console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${sortedBrands.length} Ù†ÙˆØ¹ Ø³ÙŠØ§Ø±Ø©`);

            // Test the dropdown
            console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©:');
            console.log('   Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:', carBrandSearch.options.length);
            for (let i = 0; i < carBrandSearch.options.length; i++) {
                console.log(`   Ø®ÙŠØ§Ø± ${i}: "${carBrandSearch.options[i].value}" - "${carBrandSearch.options[i].text}"`);
            }
        }

        // Load search car years
        function loadSearchCarYears() {
            console.log('ğŸ“… ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø¨Ø­Ø«...');
            const carYearSearch = document.getElementById('carYearSearch');
            if (!carYearSearch) {
                console.log('âŒ Ø¹Ù†ØµØ± carYearSearch ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            // Get unique years from products
            const years = new Set();
            const productYears = new Set();

            console.log('ğŸ“Š ÙØ­Øµ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª...');
            products.forEach((product, index) => {
                console.log(`ğŸ“¦ Ù…Ù†ØªØ¬ ${index + 1}: ${product.name}`);
                console.log(`   Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: "${product.model}"`);

                if (product.model && product.model.trim() && product.model !== 'Ø¹Ø§Ù…') {
                    // Extract year from model if it contains numbers
                    const yearMatch = product.model.match(/\d{4}/);
                    if (yearMatch) {
                        const year = yearMatch[0];
                        years.add(year);
                        productYears.add(year);
                        console.log(`ğŸ“… Ø¥Ø¶Ø§ÙØ© Ø³Ù†Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${year} (Ù…Ù† ${product.name})`);
                    } else {
                        console.log(`âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù†Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: "${product.model}"`);
                    }
                } else {
                    console.log(`âš ï¸ Ù…ÙˆØ¯ÙŠÙ„ ÙØ§Ø±Øº Ø£Ùˆ Ø¹Ø§Ù…: "${product.model}"`);
                }
            });

            console.log('ğŸ“… Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', Array.from(productYears).sort());

            // Add common years
            for (let year = 2024; year >= 2000; year--) {
                years.add(year.toString());
            }
            years.add('Ø¹Ø§Ù…');

            // Update car year search dropdown
            carYearSearch.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</option>';
            const sortedYears = Array.from(years).sort((a, b) => {
                if (a === 'Ø¹Ø§Ù…') return 1;
                if (b === 'Ø¹Ø§Ù…') return -1;
                return b.localeCompare(a);
            });

            console.log('ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø©:', sortedYears.slice(0, 15), '...');
            console.log('ğŸ“… Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©:', Array.from(productYears).sort().reverse());

            sortedYears.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                // Mark years that exist in products
                if (productYears.has(year)) {
                    option.textContent += ' âœ“';
                }
                carYearSearch.appendChild(option);
            });

            console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${sortedYears.length} Ù…ÙˆØ¯ÙŠÙ„ (${productYears.size} Ù…Ù†Ù‡Ø§ Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©)`);

            // Test the dropdown
            console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª:');
            console.log('   Ø¹Ø¯Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:', carYearSearch.options.length);
            for (let i = 0; i < Math.min(carYearSearch.options.length, 10); i++) {
                console.log(`   Ø®ÙŠØ§Ø± ${i}: "${carYearSearch.options[i].value}" - "${carYearSearch.options[i].text}"`);
            }
        }

        // Update search car models based on selected brand
        function updateSearchCarModels() {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª...');
            const carBrandSearch = document.getElementById('carBrandSearch');
            const carModelSearch = document.getElementById('carModelSearch');

            if (!carBrandSearch || !carModelSearch) {
                console.log('âŒ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                return;
            }

            const selectedBrand = carBrandSearch.value;
            console.log('ğŸš— Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±:', selectedBrand);

            // Clear existing options
            carModelSearch.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</option>';

            if (!selectedBrand) {
                console.log('ğŸ“‹ Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');
                // If no brand selected, show all models from products
                const allModels = new Set();
                products.forEach(product => {
                    if (product.model && product.model.trim() && product.model !== 'Ø¹Ø§Ù…') {
                        // Extract model name (remove year if present)
                        let modelName = product.model.trim();
                        modelName = modelName.replace(/\s*\d{4}\s*/, '').trim();
                        if (modelName) {
                            allModels.add(modelName);
                            console.log('ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', modelName);
                        }
                    }
                });

                Array.from(allModels).sort().forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    carModelSearch.appendChild(option);
                });

                console.log(`âœ… ØªÙ… Ø¹Ø±Ø¶ ${allModels.size} Ù…Ø§Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª`);
            } else {
                console.log('ğŸ” Ø¹Ø±Ø¶ Ù…Ø§Ø±ÙƒØ§Øª Ù„Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:', selectedBrand);
                const brandModels = new Set();

                // Add models from carModels data
                if (carModels[selectedBrand]) {
                    carModels[selectedBrand].forEach(model => {
                        brandModels.add(model);
                        console.log('ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø±ÙƒØ© Ù…Ù† carModels:', model);
                    });
                }

                // Add models from existing products for this brand
                products.forEach(product => {
                    if (product.brand === selectedBrand && product.model && product.model.trim() && product.model !== 'Ø¹Ø§Ù…') {
                        let modelName = product.model.trim();
                        modelName = modelName.replace(/\s*\d{4}\s*/, '').trim();
                        if (modelName) {
                            brandModels.add(modelName);
                            console.log('ğŸ·ï¸ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', modelName);
                        }
                    }
                });

                // Add all models to dropdown
                Array.from(brandModels).sort().forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    carModelSearch.appendChild(option);
                });

                console.log(`âœ… ØªÙ… Ø¹Ø±Ø¶ ${brandModels.size} Ù…Ø§Ø±ÙƒØ© Ù„Ù€ ${selectedBrand}`);
            }
        }

        // Perform search
        function performSearch() {
            console.log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø«...');

            // Get all search field values
            const searchTerm = document.getElementById('searchInput')?.value.trim().toLowerCase() || '';
            const partNumberSearch = document.getElementById('partNumberSearch')?.value.trim().toLowerCase() || '';
            const categoryFilter = document.getElementById('categoryFilter')?.value || '';
            const brandFilter = document.getElementById('brandFilter')?.value || '';
            const modelFilter = document.getElementById('modelFilter')?.value || '';
            const carBrandSearch = document.getElementById('carBrandSearch')?.value || '';
            const carModelSearch = document.getElementById('carModelSearch')?.value || '';
            const carYearSearch = document.getElementById('carYearSearch')?.value || '';
            const searchResults = document.getElementById('searchResults');

            console.log('ğŸ“Š Ù‚ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«:', {
                searchTerm, partNumberSearch, categoryFilter,
                carBrandSearch, carModelSearch, carYearSearch,
                brandFilter, modelFilter
            });

            let filteredProducts = [...products]; // Create a copy
            let searchDescription = [];
            let searchType = '';

            // Determine which search type is active and apply only that filter
            if (searchTerm) {
                console.log('ğŸ”¤ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ:', searchTerm);
                // Text search only
                filteredProducts = filteredProducts.filter(product => {
                    const nameMatch = product.name && product.name.toLowerCase().includes(searchTerm);
                    const partMatch = product.partNumber && product.partNumber.toLowerCase().includes(searchTerm);
                    const brandMatch = product.brand && product.brand.toLowerCase().includes(searchTerm);
                    const modelMatch = product.model && product.model.toLowerCase().includes(searchTerm);
                    const descMatch = product.description && product.description.toLowerCase().includes(searchTerm);

                    return nameMatch || partMatch || brandMatch || modelMatch || descMatch;
                });
                searchDescription.push(`Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ: "${searchTerm}"`);
                searchType = 'text';

            } else if (partNumberSearch) {
                console.log('ğŸ·ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©:', partNumberSearch);
                // Part number search only
                filteredProducts = filteredProducts.filter(product =>
                    product.partNumber && product.partNumber.toLowerCase().includes(partNumberSearch)
                );
                searchDescription.push(`Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: "${partNumberSearch}"`);
                searchType = 'partNumber';

            } else if (categoryFilter) {
                console.log('ğŸ“‚ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙØ¦Ø©:', categoryFilter);
                // Category search only
                filteredProducts = filteredProducts.filter(product =>
                    product.category === categoryFilter
                );
                searchDescription.push(`Ø§Ù„ÙØ¦Ø©: ${categoryFilter}`);
                searchType = 'category';

            } else if (carBrandSearch || carModelSearch || carYearSearch) {
                console.log('ğŸš— ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
                // Car information search - can combine multiple car fields

                if (carBrandSearch) {
                    console.log('ğŸš— ÙÙ„ØªØ±Ø© Ø¨Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:', carBrandSearch);
                    filteredProducts = filteredProducts.filter(product =>
                        product.brand === carBrandSearch
                    );
                    searchDescription.push(`Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${carBrandSearch}`);
                }

                if (carModelSearch) {
                    console.log('ğŸ·ï¸ ÙÙ„ØªØ±Ø© Ø¨Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©:', carModelSearch);
                    filteredProducts = filteredProducts.filter(product => {
                        if (product.model && product.model.trim()) {
                            const modelName = product.model.trim();
                            // Check if model contains the search term or matches exactly after removing year
                            const modelWithoutYear = modelName.replace(/\s*\d{4}\s*/, '').trim();
                            return modelName.includes(carModelSearch) || modelWithoutYear === carModelSearch;
                        }
                        return false;
                    });
                    searchDescription.push(`Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${carModelSearch}`);
                }

                if (carYearSearch && carYearSearch !== 'Ø¹Ø§Ù…') {
                    console.log('ğŸ“… ÙÙ„ØªØ±Ø© Ø¨Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:', carYearSearch);
                    console.log('ğŸ“Š Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø¨Ù„ ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:', filteredProducts.length);

                    filteredProducts = filteredProducts.filter(product => {
                        if (product.model && product.model.trim()) {
                            const modelText = product.model.trim();
                            const hasYear = modelText.includes(carYearSearch);
                            console.log(`ğŸ” ÙØ­Øµ Ø§Ù„Ù…Ù†ØªØ¬: ${product.name}`);
                            console.log(`   Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: "${modelText}"`);
                            console.log(`   Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "${carYearSearch}"`);
                            console.log(`   ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù†Ø©: ${hasYear}`);
                            return hasYear;
                        }
                        console.log(`âŒ Ø§Ù„Ù…Ù†ØªØ¬ ${product.name} Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ÙˆØ¯ÙŠÙ„`);
                        return false;
                    });

                    console.log('ğŸ“Š Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:', filteredProducts.length);
                    searchDescription.push(`Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${carYearSearch}`);
                }
                searchType = 'car';

            } else if (brandFilter) {
                console.log('ğŸ·ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:', brandFilter);
                // Old brand filter (for backward compatibility)
                filteredProducts = filteredProducts.filter(product =>
                    product.brand === brandFilter
                );
                searchDescription.push(`Ø§Ù„Ù…Ø§Ø±ÙƒØ©: ${brandFilter}`);
                searchType = 'oldBrand';

            } else if (modelFilter) {
                console.log('ğŸš— ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…:', modelFilter);
                // Old model filter (for backward compatibility)
                filteredProducts = filteredProducts.filter(product =>
                    product.model === modelFilter
                );
                searchDescription.push(`Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${modelFilter}`);
                searchType = 'oldModel';
            }

            console.log(`âœ… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: ${filteredProducts.length} Ù…Ù† Ø£ØµÙ„ ${products.length}`);

            // Log filtered products for debugging
            if (filteredProducts.length > 0) {
                console.log('ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©:');
                filteredProducts.forEach((product, index) => {
                    console.log(`   ${index + 1}. ${product.name} (${product.brand} - ${product.model})`);
                });
            } else {
                console.log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«');
                console.log('ğŸ” Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:', searchDescription);
            }

            // Update search results text
            if (searchDescription.length > 0) {
                const resultText = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${filteredProducts.length} Ù…Ù†ØªØ¬ Ù…Ù† Ø£ØµÙ„ ${products.length}`;
                const filterText = searchDescription.join(' + ');

                if (searchResults) {
                    searchResults.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <span>${resultText}</span>
                            <span class="badge bg-primary">${getSearchTypeLabel(searchType)}</span>
                        </div>
                        <small class="text-muted">${filterText}</small>
                    `;
                }

                if (filteredProducts.length === 0) {
                    showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«', 'warning');
                } else {
                    showNotification(`${resultText} - ${getSearchTypeLabel(searchType)}`, 'success');
                }
            } else {
                if (searchResults) {
                    searchResults.textContent = '';
                }
            }

            // Display filtered products
            displayProducts(filteredProducts);
        }

        // Manual test function for car search
        window.testCarBrandSearchManual = function(brandName) {
            console.log(`ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¨Ø­Ø« Ø¨Ù€: ${brandName}`);

            const carBrandSearch = document.getElementById('carBrandSearch');
            if (!carBrandSearch) {
                console.log('âŒ Ø¹Ù†ØµØ± carBrandSearch ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            // Clear other searches
            clearAllSearches();

            // Set the brand
            carBrandSearch.value = brandName;
            console.log('ğŸ”§ ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¥Ù„Ù‰:', carBrandSearch.value);

            // Clear other searches and perform search
            clearOtherSearches('car');
            performSearch();
        }

        // Manual test function for car year search
        window.testCarYearSearchManual = function(yearName) {
            console.log(`ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¨Ø­Ø« Ø¨Ù…ÙˆØ¯ÙŠÙ„: ${yearName}`);

            const carYearSearch = document.getElementById('carYearSearch');
            if (!carYearSearch) {
                console.log('âŒ Ø¹Ù†ØµØ± carYearSearch ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            // Clear other searches
            clearAllSearches();

            // Set the year
            carYearSearch.value = yearName;
            console.log('ğŸ”§ ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¥Ù„Ù‰:', carYearSearch.value);

            // Clear other searches and perform search
            clearOtherSearches('car');
            performSearch();
        }

        // Test all available years
        window.testAllCarYears = function() {
            console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª...');

            const carYearSearch = document.getElementById('carYearSearch');
            if (!carYearSearch) {
                console.log('âŒ Ø¹Ù†ØµØ± carYearSearch ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
                return;
            }

            console.log('ğŸ“‹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:');
            for (let i = 1; i < carYearSearch.options.length && i <= 10; i++) {
                const year = carYearSearch.options[i].value;
                console.log(`   ${i}. ${year}`);
            }

            // Test specific years from our data
            const testYears = ['2015', '2017', '2018', '2019', '2020'];
            testYears.forEach((year, index) => {
                setTimeout(() => {
                    console.log(`ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆØ¯ÙŠÙ„: ${year}`);
                    testCarYearSearchManual(year);
                }, (index + 1) * 1000);
            });
        }

        // Show detailed product analysis
        window.showProductAnalysis = function() {
            console.log('ğŸ“Š ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª...');
            console.log('ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:', products.length);

            products.forEach((product, index) => {
                console.log(`\nğŸ“¦ Ù…Ù†ØªØ¬ ${index + 1}:`);
                console.log(`   Ø§Ù„Ø§Ø³Ù…: "${product.name}"`);
                console.log(`   Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: "${product.brand}"`);
                console.log(`   Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„: "${product.model}"`);

                // Extract year
                if (product.model && product.model.trim()) {
                    const yearMatch = product.model.match(/\d{4}/);
                    if (yearMatch) {
                        console.log(`   Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©: ${yearMatch[0]}`);
                        console.log(`   Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø¨Ø¯ÙˆÙ† Ø³Ù†Ø©: "${product.model.replace(/\s*\d{4}\s*/, '').trim()}"`);
                    } else {
                        console.log(`   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù†Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„`);
                    }
                }

                console.log(`   Ø§Ù„ÙØ¦Ø©: "${product.category}"`);
                console.log(`   Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: "${product.partNumber}"`);
            });

            // Show year distribution
            const yearCounts = {};
            products.forEach(product => {
                if (product.model && product.model.trim()) {
                    const yearMatch = product.model.match(/\d{4}/);
                    if (yearMatch) {
                        const year = yearMatch[0];
                        yearCounts[year] = (yearCounts[year] || 0) + 1;
                    }
                }
            });

            console.log('\nğŸ“… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©:');
            Object.entries(yearCounts).sort().forEach(([year, count]) => {
                console.log(`   ${year}: ${count} Ù…Ù†ØªØ¬`);
            });
        }

        // Get search type label
        function getSearchTypeLabel(searchType) {
            const labels = {
                'text': 'Ø¨Ø­Ø« Ù†ØµÙŠ',
                'partNumber': 'Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©',
                'category': 'Ø¨Ø­Ø« Ø¨Ø§Ù„ÙØ¦Ø©',
                'car': 'Ø¨Ø­Ø« Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©',
                'oldBrand': 'Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…Ø§Ø±ÙƒØ©',
                'oldModel': 'Ø¨Ø­Ø« Ø¨Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„'
            };
            return labels[searchType] || 'Ø¨Ø­Ø« Ø¹Ø§Ù…';
        }

        // Test search functionality
        function testSearchFunctionality() {
            console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨Ø­Ø«...');

            // Test if all search elements exist
            const searchElements = [
                'searchInput',
                'partNumberSearch',
                'categoryFilter',
                'carBrandSearch',
                'carModelSearch',
                'carYearSearch',
                'brandFilter',
                'modelFilter'
            ];

            searchElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    console.log(`âœ… ${elementId} Ù…ÙˆØ¬ÙˆØ¯`);
                    if (element.tagName === 'SELECT') {
                        console.log(`   ğŸ“‹ Ø®ÙŠØ§Ø±Ø§Øª ${elementId}:`, element.options.length);
                    }
                } else {
                    console.log(`âŒ ${elementId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
                }
            });

            // Test search with sample data
            console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', products.length);
            products.forEach((product, index) => {
                console.log(`ğŸ“¦ Ù…Ù†ØªØ¬ ${index + 1}:`, {
                    name: product.name,
                    partNumber: product.partNumber,
                    category: product.category,
                    brand: product.brand,
                    model: product.model
                });
            });

            // Test car search specifically
            testCarSearch();
        }

        // Test car search functionality
        function testCarSearch() {
            console.log('ğŸš— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©...');

            // Test car brand loading
            const carBrandSearch = document.getElementById('carBrandSearch');
            if (carBrandSearch) {
                console.log('ğŸ·ï¸ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:', carBrandSearch.options.length - 1);
                for (let i = 1; i < carBrandSearch.options.length; i++) {
                    console.log(`   - ${carBrandSearch.options[i].value}`);
                }
            }

            // Test search with each brand
            setTimeout(() => {
                testCarBrandSearch();
            }, 500);
        }

        // Test car brand search specifically
        function testCarBrandSearch() {
            console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¨Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©...');
            const carBrandSearch = document.getElementById('carBrandSearch');

            if (!carBrandSearch || carBrandSearch.options.length <= 1) {
                console.log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ø³ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }

            // Test each brand
            for (let i = 1; i < carBrandSearch.options.length && i <= 3; i++) {
                const brand = carBrandSearch.options[i].value;
                console.log(`ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¨Ù€: ${brand}`);

                // Set the brand
                carBrandSearch.value = brand;

                // Trigger search
                clearOtherSearches('car');
                performSearch();

                // Check results
                setTimeout(() => {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults && searchResults.textContent) {
                        console.log(`âœ… Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù€ ${brand}:`, searchResults.textContent);
                    } else {
                        console.log(`âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø« Ø¨Ù€ ${brand}`);
                    }

                    // Reset for next test
                    carBrandSearch.value = '';
                    clearAllSearches();
                }, 100 * i);
            }
        }

        // Clear other searches when one type is selected
        function clearOtherSearches(activeType) {
            console.log('ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¢Ø®Ø±ØŒ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø·:', activeType);

            const searchTypes = {
                'text': ['partNumberSearch', 'categoryFilter', 'carBrandSearch', 'carModelSearch', 'carYearSearch', 'brandFilter', 'modelFilter'],
                'partNumber': ['searchInput', 'categoryFilter', 'carBrandSearch', 'carModelSearch', 'carYearSearch', 'brandFilter', 'modelFilter'],
                'category': ['searchInput', 'partNumberSearch', 'carBrandSearch', 'carModelSearch', 'carYearSearch', 'brandFilter', 'modelFilter'],
                'car': ['searchInput', 'partNumberSearch', 'categoryFilter', 'brandFilter', 'modelFilter']
            };

            if (searchTypes[activeType]) {
                searchTypes[activeType].forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        const oldValue = field.value;
                        field.value = '';
                        if (oldValue) {
                            console.log(`ğŸ§¹ Ù…Ø³Ø­ ${fieldId}: "${oldValue}"`);
                        }
                    }
                });

                // Update car models if car search is cleared
                if (activeType !== 'car') {
                    updateSearchCarModels();
                }
            }
        }

        // Clear all searches
        function clearAllSearches() {
            // Clear all search fields
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('searchResults').textContent = '';

            // Clear new search fields
            const partNumberSearch = document.getElementById('partNumberSearch');
            const carBrandSearch = document.getElementById('carBrandSearch');
            const carModelSearch = document.getElementById('carModelSearch');
            const carYearSearch = document.getElementById('carYearSearch');

            if (partNumberSearch) partNumberSearch.value = '';
            if (carBrandSearch) carBrandSearch.value = '';
            if (carModelSearch) carModelSearch.value = '';
            if (carYearSearch) carYearSearch.value = '';

            // Reload models to show all models again
            loadModels();
            updateSearchCarModels();

            displayProducts(products);
            showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ù…Ø±Ø´Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø«', 'info');
        }

        // Legacy clear search function for backward compatibility
        function clearSearch() {
            clearAllSearches();
        }

        // Filter by category
        function filterByCategory(categoryName) {
            document.getElementById('categoryFilter').value = categoryName;
            document.getElementById('searchInput').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('modelFilter').value = '';
            loadModels();
            performSearch();
        }

        // Filter by brand
        function filterByBrand(brandName) {
            document.getElementById('brandFilter').value = brandName;
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('modelFilter').value = '';
            loadModels();
            performSearch();
        }

        // Filter by model
        function filterByModel(brandName, modelName) {
            document.getElementById('brandFilter').value = brandName;
            document.getElementById('modelFilter').value = modelName;
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            loadModels();
            performSearch();
        }

        // Show all categories
        function showAllCategories() {
            const categoriesCard = document.getElementById('categoriesCard');
            const brandsCard = document.getElementById('brandsCard');
            const modelsCard = document.getElementById('modelsCard');

            // Hide other cards
            brandsCard.style.display = 'none';
            modelsCard.style.display = 'none';

            if (categoriesCard.style.display === 'none') {
                categoriesCard.style.display = 'block';
                showNotification('ØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª', 'info');
            } else {
                categoriesCard.style.display = 'none';
                showNotification('ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙØ¦Ø§Øª', 'info');
            }
        }

        // Show all brands
        function showAllBrands() {
            const categoriesCard = document.getElementById('categoriesCard');
            const brandsCard = document.getElementById('brandsCard');
            const modelsCard = document.getElementById('modelsCard');
            const brandsContainer = document.getElementById('brandsContainer');

            // Hide other cards
            categoriesCard.style.display = 'none';
            modelsCard.style.display = 'none';

            if (brandsCard.style.display === 'none') {
                brandsCard.style.display = 'block';
                loadBrandsDisplay();
                showNotification('ØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª', 'info');
            } else {
                brandsCard.style.display = 'none';
                showNotification('ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª', 'info');
            }
        }

        // Show all models
        function showAllModels() {
            const categoriesCard = document.getElementById('categoriesCard');
            const brandsCard = document.getElementById('brandsCard');
            const modelsCard = document.getElementById('modelsCard');

            // Hide other cards
            categoriesCard.style.display = 'none';
            brandsCard.style.display = 'none';

            if (modelsCard.style.display === 'none') {
                modelsCard.style.display = 'block';
                loadModelsDisplay();
                showNotification('ØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª', 'info');
            } else {
                modelsCard.style.display = 'none';
                showNotification('ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª', 'info');
            }
        }

        // Load brands display
        function loadBrandsDisplay() {
            const brandsContainer = document.getElementById('brandsContainer');

            // Get unique brands with statistics
            const brands = {};
            products.forEach(product => {
                if (product.brand && product.brand.trim()) {
                    const brandName = product.brand.trim();
                    if (!brands[brandName]) {
                        brands[brandName] = {
                            name: brandName,
                            count: 0,
                            totalQuantity: 0,
                            avgPrice: 0,
                            models: new Set(),
                            products: []
                        };
                    }
                    brands[brandName].count++;
                    brands[brandName].products.push(product);

                    if (product.model && product.model.trim()) {
                        brands[brandName].models.add(product.model.trim());
                    }

                    // Calculate total quantity and average price
                    product.shopDetails.forEach(shop => {
                        brands[brandName].totalQuantity += shop.quantity;
                        brands[brandName].avgPrice += shop.price;
                    });
                }
            });

            // Calculate average prices
            Object.keys(brands).forEach(brandName => {
                const brand = brands[brandName];
                const totalPrices = brand.products.reduce((sum, product) => {
                    return sum + product.shopDetails.reduce((pSum, shop) => pSum + shop.price, 0);
                }, 0);
                const totalShops = brand.products.reduce((sum, product) => sum + product.shopDetails.length, 0);
                brand.avgPrice = totalShops > 0 ? Math.round(totalPrices / totalShops) : 0;
            });

            brandsContainer.innerHTML = '';
            if (Object.keys(brands).length === 0) {
                brandsContainer.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø§Ø±ÙƒØ§Øª Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
                        </div>
                    </div>
                `;
                return;
            }

            Object.keys(brands).sort().forEach(brandName => {
                const brand = brands[brandName];
                const brandCard = `
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="card product-card h-100" style="cursor: pointer;" onclick="filterByBrand('${brandName}')">
                            <div class="card-body text-center">
                                <div class="mb-2">
                                    <i class="fas fa-car fa-2x text-success"></i>
                                </div>
                                <h6 class="card-title text-success">${brandName}</h6>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <small class="text-muted">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</small>
                                        <div class="fw-bold text-primary">${brand.count}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</small>
                                        <div class="fw-bold text-info">${brand.models.size}</div>
                                    </div>
                                </div>
                                <div class="row text-center mt-2">
                                    <div class="col-6">
                                        <small class="text-muted">Ø§Ù„ÙƒÙ…ÙŠØ©</small>
                                        <div class="fw-bold text-warning">${brand.totalQuantity}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</small>
                                        <div class="fw-bold text-danger">${brand.avgPrice} Ø±ÙŠØ§Ù„</div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-outline-success btn-sm" onclick="event.stopPropagation(); filterByBrand('${brandName}')">
                                        <i class="fas fa-search me-1"></i>
                                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                brandsContainer.innerHTML += brandCard;
            });
        }

        // Load models display
        function loadModelsDisplay() {
            const modelsContainer = document.getElementById('modelsContainer');

            // Get unique models with statistics grouped by brand
            const modelsByBrand = {};
            products.forEach(product => {
                if (product.model && product.model.trim()) {
                    const modelName = product.model.trim();
                    const brandName = product.brand && product.brand.trim() ? product.brand.trim() : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

                    if (!modelsByBrand[brandName]) {
                        modelsByBrand[brandName] = {};
                    }

                    if (!modelsByBrand[brandName][modelName]) {
                        modelsByBrand[brandName][modelName] = {
                            name: modelName,
                            brand: brandName,
                            count: 0,
                            totalQuantity: 0,
                            avgPrice: 0,
                            products: []
                        };
                    }

                    modelsByBrand[brandName][modelName].count++;
                    modelsByBrand[brandName][modelName].products.push(product);

                    // Calculate total quantity and average price
                    product.shopDetails.forEach(shop => {
                        modelsByBrand[brandName][modelName].totalQuantity += shop.quantity;
                        modelsByBrand[brandName][modelName].avgPrice += shop.price;
                    });
                }
            });

            // Calculate average prices
            Object.keys(modelsByBrand).forEach(brandName => {
                Object.keys(modelsByBrand[brandName]).forEach(modelName => {
                    const model = modelsByBrand[brandName][modelName];
                    const totalPrices = model.products.reduce((sum, product) => {
                        return sum + product.shopDetails.reduce((pSum, shop) => pSum + shop.price, 0);
                    }, 0);
                    const totalShops = model.products.reduce((sum, product) => sum + product.shopDetails.length, 0);
                    model.avgPrice = totalShops > 0 ? Math.round(totalPrices / totalShops) : 0;
                });
            });

            modelsContainer.innerHTML = '';
            if (Object.keys(modelsByBrand).length === 0) {
                modelsContainer.innerHTML = `
                    <div class="col-12 text-center">
                        <div class="alert alert-info mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
                        </div>
                    </div>
                `;
                return;
            }

            // Display models grouped by brand
            Object.keys(modelsByBrand).sort().forEach(brandName => {
                const models = modelsByBrand[brandName];

                // Add brand header
                modelsContainer.innerHTML += `
                    <div class="col-12 mb-3">
                        <h6 class="text-primary border-bottom pb-2">
                            <i class="fas fa-car me-2"></i>
                            ${brandName}
                        </h6>
                    </div>
                `;

                Object.keys(models).sort().forEach(modelName => {
                    const model = models[modelName];
                    const modelCard = `
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                            <div class="card product-card h-100" style="cursor: pointer;" onclick="filterByModel('${brandName}', '${modelName}')">
                                <div class="card-body text-center">
                                    <div class="mb-2">
                                        <i class="fas fa-cogs fa-2x text-warning"></i>
                                    </div>
                                    <h6 class="card-title text-warning">${modelName}</h6>
                                    <small class="text-muted">${brandName}</small>
                                    <div class="row text-center mt-2">
                                        <div class="col-6">
                                            <small class="text-muted">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</small>
                                            <div class="fw-bold text-primary">${model.count}</div>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted">Ø§Ù„ÙƒÙ…ÙŠØ©</small>
                                            <div class="fw-bold text-info">${model.totalQuantity}</div>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</small>
                                        <div class="fw-bold text-success">${model.avgPrice} Ø±ÙŠØ§Ù„</div>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-outline-warning btn-sm" onclick="event.stopPropagation(); filterByModel('${brandName}', '${modelName}')">
                                            <i class="fas fa-search me-1"></i>
                                            Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    modelsContainer.innerHTML += modelCard;
                });
            });
        }

        // Update summary cards
        function updateSummaryCards() {
            const totalProducts = products.length;
            const uniqueShops = new Set();
            let totalQuantity = 0;
            let totalPrice = 0;
            let priceCount = 0;

            products.forEach(product => {
                product.shopDetails.forEach(shop => {
                    uniqueShops.add(shop.shopName);
                    totalQuantity += shop.quantity;
                    totalPrice += shop.price;
                    priceCount++;
                });
            });

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalShops').textContent = uniqueShops.size;
            document.getElementById('totalQuantity').textContent = totalQuantity;
            document.getElementById('averagePrice').textContent = priceCount > 0 ? Math.round(totalPrice / priceCount) + ' Ø±ÙŠØ§Ù„' : '0 Ø±ÙŠØ§Ù„';
        }

        // Load shops
        function loadShops() {
            const container = document.getElementById('shopsContainer');
            const addShopBtn = document.getElementById('addShopBtn');

            // Show/hide add shop button based on user role
            if (addShopBtn) {
                if (currentUser && currentUser.role === 'admin') {
                    addShopBtn.style.display = 'inline-block';
                } else {
                    addShopBtn.style.display = 'none';
                }
            }

            container.innerHTML = '';

            if (shops.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-4">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ù„Ø§Øª
                        </div>
                    </div>
                `;
                return;
            }

            shops.forEach(shop => {
                const shopProducts = products.filter(product =>
                    product.shopDetails.some(detail => detail.shopId === shop.id)
                );

                const shopCard = `
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card product-card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-primary">${shop.name}</h5>
                                <p class="card-text text-muted">${shop.description}</p>

                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fas fa-phone me-1"></i>${shop.phone}<br>
                                        <i class="fas fa-map-marker-alt me-1"></i>${shop.address}, ${shop.city}<br>
                                        ${shop.specialty ? `<i class="fas fa-tag me-1"></i>${shop.specialty}<br>` : ''}
                                        <i class="fas fa-calendar me-1"></i>Ø§Ù†Ø¶Ù… ÙÙŠ ${shop.joinDate}
                                    </small>
                                </div>

                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-primary">${shopProducts.length} Ù…Ù†ØªØ¬</span>
                                        <span class="badge bg-warning">â­ ${shop.rating}</span>
                                    </div>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="viewShopProducts(${shop.id})" title="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        ${currentUser && currentUser.role === 'admin' ? `
                                            <button class="btn btn-outline-warning" onclick="editShop(${shop.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteShop(${shop.id})" title="Ø­Ø°Ù">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += shopCard;
            });

            showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // Handle login
        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const alertDiv = document.getElementById('loginAlert');

            if (users[username] && users[username].password === password) {
                currentUser = { username, ...users[username] };

                // Update UI
                document.getElementById('loginLink').style.display = 'none';
                document.getElementById('logoutLink').style.display = 'inline';
                document.getElementById('dashboardLink').style.display = 'inline';
                document.getElementById('dashboardLink').textContent = currentUser.role === 'admin' ? 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ù„';
                document.getElementById('userWelcome').style.display = 'inline';
                document.getElementById('userWelcome').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`;

                // Show success message
                alertDiv.className = 'alert alert-success';
                alertDiv.textContent = 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!';
                alertDiv.style.display = 'block';

                showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.`, 'success');

                // Redirect to dashboard
                setTimeout(() => {
                    showPage('dashboard');
                }, 1000);

            } else {
                alertDiv.className = 'alert alert-danger';
                alertDiv.textContent = 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                alertDiv.style.display = 'block';
            }
        }

        // Logout
        function logout() {
            currentUser = null;
            document.getElementById('loginLink').style.display = 'inline';
            document.getElementById('logoutLink').style.display = 'none';
            document.getElementById('dashboardLink').style.display = 'none';
            document.getElementById('userWelcome').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('loginAlert').style.display = 'none';

            showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
            showPage('home');
        }

        // Load dashboard
        function loadDashboard() {
            if (!currentUser) {
                showPage('login');
                return;
            }

            if (currentUser.role === 'admin') {
                loadAdminDashboard();
            } else if (currentUser.role === 'shop') {
                loadShopDashboard();
            }
        }

        // Load admin dashboard
        function loadAdminDashboard() {
            document.getElementById('dashboardTitle').textContent = 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±';
            document.getElementById('dashboardMessage').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`;

            document.getElementById('dashboardProducts').textContent = products.length;
            document.getElementById('dashboardShops').textContent = shops.length;

            const totalValue = products.reduce((sum, product) => {
                return sum + product.shopDetails.reduce((pSum, shop) => pSum + (shop.price * shop.quantity), 0);
            }, 0);
            document.getElementById('dashboardValue').textContent = Math.round(totalValue) + ' Ø±ÙŠØ§Ù„';

            // Show all products for admin
            const container = document.getElementById('dashboardProductsContainer');
            container.innerHTML = '';

            if (products.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-4">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle me-2"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h5>
                            <p class="mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
                        </div>
                    </div>
                `;
                return;
            }

            products.forEach(product => {
                const totalQuantity = product.shopDetails.reduce((sum, shop) => sum + shop.quantity, 0);
                const avgPrice = product.shopDetails.reduce((sum, shop) => sum + shop.price, 0) / product.shopDetails.length;

                const productCard = `
                    <div class="col-lg-4 col-md-6 mb-3">
                        <div class="card product-card">
                            <div class="card-body">
                                <h6 class="card-title">${product.name}</h6>
                                <p class="text-muted small">${product.description ? product.description.substring(0, 50) + '...' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>

                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fw-bold text-primary">${Math.round(avgPrice)} Ø±ÙŠØ§Ù„</span>
                                    <span class="badge bg-success">Ø§Ù„ÙƒÙ…ÙŠØ©: ${totalQuantity}</span>
                                </div>

                                ${product.category ? `<span class="badge bg-secondary badge-sm">${product.category}</span>` : ''}
                                ${product.brand ? `<span class="badge bg-info badge-sm ms-1">${product.brand}</span>` : ''}
                                ${product.partNumber ? `<br><small class="text-muted">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${product.partNumber}</small>` : ''}

                                <div class="mt-2">
                                    <button class="btn btn-outline-primary btn-sm" onclick="showProductDetail(${product.id})">
                                        <i class="fas fa-eye me-1"></i>
                                        Ø¹Ø±Ø¶
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm ms-1" onclick="deleteProduct(${product.id})">
                                        <i class="fas fa-trash me-1"></i>
                                        Ø­Ø°Ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += productCard;
            });
        }

        // Load shop dashboard
        function loadShopDashboard() {
            document.getElementById('dashboardTitle').textContent = 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø­Ù„';
            document.getElementById('dashboardMessage').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`;

            // Filter products for current shop
            const shopProducts = products.filter(product =>
                product.shopDetails.some(shop => shop.shopId === currentUser.shopId)
            );

            document.getElementById('dashboardProducts').textContent = shopProducts.length;
            document.getElementById('dashboardShops').textContent = '1';

            const totalValue = shopProducts.reduce((sum, product) => {
                const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                return sum + (shopDetail ? shopDetail.price * shopDetail.quantity : 0);
            }, 0);
            document.getElementById('dashboardValue').textContent = Math.round(totalValue) + ' Ø±ÙŠØ§Ù„';

            // Show shop products
            const container = document.getElementById('dashboardProductsContainer');
            container.innerHTML = '';

            if (shopProducts.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-4">
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle me-2"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h5>
                            <p class="mb-0">Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ÙÙŠ Ù…Ø­Ù„Ùƒ.</p>
                            <p class="mb-0">Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯" Ù„Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§ØªÙƒ.</p>
                        </div>
                    </div>
                `;
                return;
            }

            // Check if shop has all products
            const totalProductsInSystem = products.length;
            const shopProductsCount = shopProducts.length;
            const missingProductsCount = totalProductsInSystem - shopProductsCount;

            // Add bulk edit section for shop owner
            let bulkEditSection = `
                <div class="col-12 mb-4">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6><i class="fas fa-tools me-2"></i>Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹:</h6>
            `;

            // Add missing products alert if any
            if (missingProductsCount > 0) {
                bulkEditSection += `
                    <div class="alert alert-warning mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>ÙŠÙˆØ¬Ø¯ ${missingProductsCount} Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…Ø¶Ø§Ù Ù„Ù…Ø­Ù„Ùƒ Ù…Ù† Ø£ØµÙ„ ${totalProductsInSystem}</strong>
                            </div>
                            <button class="btn btn-warning btn-sm" onclick="addAllProductsToShop()">
                                <i class="fas fa-plus-circle me-1"></i>
                                Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù
                            </button>
                        </div>
                    </div>
                `;
            }

            bulkEditSection += `
                            <div class="row">
                                <div class="col-md-3">
                                    <button class="btn btn-outline-primary btn-sm w-100" onclick="showBulkPriceUpdate()">
                                        <i class="fas fa-dollar-sign me-1"></i>
                                        ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¬Ù…Ù„Ø©
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-success btn-sm w-100" onclick="showBulkQuantityUpdate()">
                                        <i class="fas fa-boxes me-1"></i>
                                        ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø¨Ø§Ù„Ø¬Ù…Ù„Ø©
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-info btn-sm w-100" onclick="showAvailableProducts()">
                                        <i class="fas fa-eye me-1"></i>
                                        Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªÙˆÙØ± ÙÙ‚Ø·
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-warning btn-sm w-100" onclick="addAllProductsToShop()">
                                        <i class="fas fa-plus-circle me-1"></i>
                                        Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = bulkEditSection;

            shopProducts.forEach(product => {
                const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                if (!shopDetail) return;

                const isAvailable = shopDetail.quantity > 0;
                const productCard = `
                    <div class="col-lg-4 col-md-6 mb-3">
                        <div class="card product-card ${!isAvailable ? 'border-warning' : ''}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title">${product.name}</h6>
                                    <span class="badge ${isAvailable ? 'bg-success' : 'bg-warning text-dark'}">
                                        ${isAvailable ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                                    </span>
                                </div>

                                <p class="text-muted small">${product.description ? product.description.substring(0, 50) + '...' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>

                                <!-- Quick Edit Form -->
                                <div class="bg-light p-2 rounded mb-2">
                                    <div class="row">
                                        <div class="col-6">
                                            <label class="form-label small">Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„)</label>
                                            <input type="number" class="form-control form-control-sm"
                                                   id="price_${product.id}" value="${shopDetail.price}"
                                                   step="0.01" min="0" onchange="quickUpdateProduct(${product.id})">
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                                            <input type="number" class="form-control form-control-sm"
                                                   id="quantity_${product.id}" value="${shopDetail.quantity}"
                                                   min="0" onchange="quickUpdateProduct(${product.id})">
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</small>
                                    <span class="fw-bold text-success" id="total_${product.id}">
                                        ${Math.round(shopDetail.price * shopDetail.quantity)} Ø±ÙŠØ§Ù„
                                    </span>
                                </div>

                                ${product.category ? `<span class="badge bg-secondary badge-sm">${product.category}</span>` : ''}
                                ${product.brand ? `<span class="badge bg-info badge-sm ms-1">${product.brand}</span>` : ''}
                                ${product.model ? `<span class="badge bg-primary badge-sm ms-1">${product.model}</span>` : ''}
                                ${product.partNumber ? `<br><small class="text-muted">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${product.partNumber}</small>` : ''}

                                <div class="mt-2 d-flex justify-content-between">
                                    <button class="btn btn-outline-success btn-sm" onclick="quickUpdateProduct(${product.id})" title="Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª">
                                        <i class="fas fa-save me-1"></i>
                                        Ø­ÙØ¸
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm" onclick="removeProductFromShop(${product.id})" title="Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…Ø­Ù„">
                                        <i class="fas fa-trash me-1"></i>
                                        Ø­Ø°Ù
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += productCard;
            });
        }

        // Show add shop modal
        function showAddShopModal() {
            if (!currentUser) {
                showNotification('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                showPage('login');
                return;
            }

            if (currentUser.role !== 'admin') {
                showNotification('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„Ø§Øª - Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·', 'danger');
                return;
            }

            const modal = `
                <div class="modal fade" id="addShopModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-store me-2"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addShopForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="shopUsername" required>
                                                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="password" class="form-control" id="shopPassword" required>
                                                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="shopName" required>
                                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ *</label>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <textarea class="form-control" id="shopDescription" style="height: 100px" required></textarea>
                                        <label>ÙˆØµÙ Ø§Ù„Ù…Ø­Ù„ *</label>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="tel" class="form-control" id="shopPhone" required>
                                                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="email" class="form-control" id="shopEmail">
                                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="shopAddress" required>
                                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="shopCity" required>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                                                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                                                    <option value="Ø¬Ø¯Ø©">Ø¬Ø¯Ø©</option>
                                                    <option value="Ø§Ù„Ø¯Ù…Ø§Ù…">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                                                    <option value="Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©">Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                                                    <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                                                </select>
                                                <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="shopSpecialty">
                                                <label>Ø§Ù„ØªØ®ØµØµ</label>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                                <button type="button" class="btn btn-success" onclick="addShop()">
                                    <i class="fas fa-save me-2"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalsContainer').innerHTML = modal;
            const modalElement = new bootstrap.Modal(document.getElementById('addShopModal'));
            modalElement.show();
        }

        // Add shop
        function addShop() {
            console.log('ğŸª Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ Ø¬Ø¯ÙŠØ¯...');

            // Check if elements exist
            const requiredElements = ['shopUsername', 'shopPassword', 'shopName', 'shopDescription', 'shopPhone', 'shopAddress', 'shopCity', 'shopSpecialty'];
            for (let elementId of requiredElements) {
                const element = document.getElementById(elementId);
                if (!element) {
                    console.error(`âŒ Ø§Ù„Ø¹Ù†ØµØ± ${elementId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
                    showNotification(`Ø®Ø·Ø£: Ø§Ù„Ø¹Ù†ØµØ± ${elementId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`, 'danger');
                    return;
                }
            }

            const shopData = {
                username: document.getElementById('shopUsername').value.trim(),
                password: document.getElementById('shopPassword').value.trim(),
                name: document.getElementById('shopName').value.trim(),
                description: document.getElementById('shopDescription').value.trim(),
                phone: document.getElementById('shopPhone').value.trim(),
                email: document.getElementById('shopEmail').value.trim(),
                address: document.getElementById('shopAddress').value.trim(),
                city: document.getElementById('shopCity').value,
                specialty: document.getElementById('shopSpecialty').value.trim()
            };

            console.log('ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„:', shopData);

            // Validation
            if (!shopData.username || !shopData.password || !shopData.name || !shopData.description ||
                !shopData.phone || !shopData.address || !shopData.city) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'warning');
                return;
            }

            // Check if username exists
            if (users[shopData.username]) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'warning');
                return;
            }

            // Check if shop name exists
            if (shops.find(shop => shop.name.toLowerCase() === shopData.name.toLowerCase())) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'warning');
                return;
            }

            // Create new shop
            const newShop = {
                id: nextShopId++,
                name: shopData.name,
                description: shopData.description,
                phone: shopData.phone,
                email: shopData.email,
                address: shopData.address,
                city: shopData.city,
                specialty: shopData.specialty,
                rating: 0,
                joinDate: new Date().toISOString().split('T')[0]
            };

            // Create new user
            users[shopData.username] = {
                password: shopData.password,
                role: 'shop',
                name: shopData.name,
                shopId: newShop.id
            };

            // Add shop to array
            shops.push(newShop);

            // Add all existing products to the new shop with default values
            products.forEach(product => {
                // Check if product doesn't already have this shop
                const existingShopDetail = product.shopDetails.find(shop => shop.shopId === newShop.id);
                if (!existingShopDetail) {
                    // Calculate average price from existing shops for reference
                    const existingPrices = product.shopDetails.map(shop => shop.price);
                    const avgPrice = existingPrices.length > 0 ?
                        Math.round(existingPrices.reduce((sum, price) => sum + price, 0) / existingPrices.length) : 100;

                    // Add this shop to the product with default values
                    product.shopDetails.push({
                        shopName: newShop.name,
                        shopId: newShop.id,
                        price: avgPrice, // Use average price as starting point
                        quantity: 0 // Start with 0 quantity - shop owner will update
                    });
                }
            });

            // Save to localStorage
            saveToStorage();
            console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addShopModal'));
            if (modal) {
                modal.hide();
                console.log('âŒ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©');
            }

            console.log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ù„ "${shopData.name}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            setTimeout(() => {
                showNotification(`Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${shopData.username} / ${shopData.password}`, 'info');
            }, 1000);
            setTimeout(() => {
                showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${products.length} Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø­Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯. ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø­Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….`, 'info');
            }, 2000);

            // Refresh shops page if currently viewing
            if (document.getElementById('shops').classList.contains('active')) {
                loadShops();
            }
        }

        // Show add product modal
        function showAddProductModal() {
            if (!currentUser) {
                showNotification('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                showPage('login');
                return;
            }

            if (currentUser.role !== 'shop' && currentUser.role !== 'admin') {
                showNotification('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª', 'danger');
                return;
            }

            const modal = `
                <div class="modal fade" id="addProductModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-box me-2"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addProductForm">
                                    <!-- Car Information Section -->
                                    <div class="alert alert-primary">
                                        <h6><i class="fas fa-car me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h6>
                                        <p class="mb-0 small">ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ù„Ù…Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹</p>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="carBrand" onchange="updateCarModels()" required>
                                                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
                                                    <option value="ØªÙˆÙŠÙˆØªØ§">ØªÙˆÙŠÙˆØªØ§</option>
                                                    <option value="Ù‡ÙˆÙ†Ø¯Ø§">Ù‡ÙˆÙ†Ø¯Ø§</option>
                                                    <option value="Ù†ÙŠØ³Ø§Ù†">Ù†ÙŠØ³Ø§Ù†</option>
                                                    <option value="Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ">Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ</option>
                                                    <option value="ÙƒÙŠØ§">ÙƒÙŠØ§</option>
                                                    <option value="Ù…Ø§Ø²Ø¯Ø§">Ù…Ø§Ø²Ø¯Ø§</option>
                                                    <option value="Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ">Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ</option>
                                                    <option value="Ø³ÙˆØ²ÙˆÙƒÙŠ">Ø³ÙˆØ²ÙˆÙƒÙŠ</option>
                                                    <option value="ÙÙˆØ±Ø¯">ÙÙˆØ±Ø¯</option>
                                                    <option value="Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡">Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡</option>
                                                    <option value="Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ">Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ</option>
                                                    <option value="Ù…Ø±Ø³ÙŠØ¯Ø³">Ù…Ø±Ø³ÙŠØ¯Ø³</option>
                                                    <option value="Ø£ÙˆØ¯ÙŠ">Ø£ÙˆØ¯ÙŠ</option>
                                                    <option value="ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†">ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†</option>
                                                    <option value="Ù„ÙƒØ²Ø³">Ù„ÙƒØ²Ø³</option>
                                                    <option value="Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ">Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ</option>
                                                    <option value="Ø£ÙƒÙˆØ±Ø§">Ø£ÙƒÙˆØ±Ø§</option>
                                                    <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù… (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª)</option>
                                                </select>
                                                <label>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="carModel" required>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©</option>
                                                </select>
                                                <label>Ø§Ù„Ù…Ø§Ø±ÙƒØ© *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="carYear" required>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</option>
                                                    <option value="2024">2024</option>
                                                    <option value="2023">2023</option>
                                                    <option value="2022">2022</option>
                                                    <option value="2021">2021</option>
                                                    <option value="2020">2020</option>
                                                    <option value="2019">2019</option>
                                                    <option value="2018">2018</option>
                                                    <option value="2017">2017</option>
                                                    <option value="2016">2016</option>
                                                    <option value="2015">2015</option>
                                                    <option value="2014">2014</option>
                                                    <option value="2013">2013</option>
                                                    <option value="2012">2012</option>
                                                    <option value="2011">2011</option>
                                                    <option value="2010">2010</option>
                                                    <option value="2009">2009</option>
                                                    <option value="2008">2008</option>
                                                    <option value="2007">2007</option>
                                                    <option value="2006">2006</option>
                                                    <option value="2005">2005</option>
                                                    <option value="2004">2004</option>
                                                    <option value="2003">2003</option>
                                                    <option value="2002">2002</option>
                                                    <option value="2001">2001</option>
                                                    <option value="2000">2000</option>
                                                    <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
                                                </select>
                                                <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ø§Ù„Ø³Ù†Ø©) *</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Product Information Section -->
                                    <div class="alert alert-success">
                                        <h6><i class="fas fa-cog me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚Ø·Ø¹Ø©</h6>
                                        <p class="mb-0 small">ØªÙØ§ØµÙŠÙ„ Ù‚Ø·Ø¹Ø© Ø§Ù„ØºÙŠØ§Ø±</p>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="partNumber">
                                                <label>ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù / Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="productCategory">
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                                                    <option value="ÙÙ„Ø§ØªØ±">ÙÙ„Ø§ØªØ±</option>
                                                    <option value="ÙØ±Ø§Ù…Ù„">ÙØ±Ø§Ù…Ù„</option>
                                                    <option value="Ø²ÙŠÙˆØª">Ø²ÙŠÙˆØª</option>
                                                    <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                                                    <option value="Ø¥Ø·Ø§Ø±Ø§Øª">Ø¥Ø·Ø§Ø±Ø§Øª</option>
                                                    <option value="Ù…Ø­Ø±Ùƒ">Ù…Ø­Ø±Ùƒ</option>
                                                    <option value="ØªÙƒÙŠÙŠÙ">ØªÙƒÙŠÙŠÙ</option>
                                                    <option value="Ø¹Ø§Ø¯Ù…">Ø¹Ø§Ø¯Ù…</option>
                                                    <option value="ØªØ¹Ù„ÙŠÙ‚">ØªØ¹Ù„ÙŠÙ‚</option>
                                                    <option value="ØªÙˆØ¬ÙŠÙ‡">ØªÙˆØ¬ÙŠÙ‡</option>
                                                    <option value="Ø¥Ø¶Ø§Ø¡Ø©">Ø¥Ø¶Ø§Ø¡Ø©</option>
                                                    <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                                                </select>
                                                <label>ÙØ¦Ø© Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="productName" required>
                                        <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù *</label>
                                        <div class="form-text">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ù„Ù‚Ø·Ø¹Ø©</div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <textarea class="form-control" id="productDescription" style="height: 100px"></textarea>
                                        <label>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                                    </div>

                                    <!-- Pricing Section -->
                                    <div class="alert alert-warning">
                                        <h6><i class="fas fa-dollar-sign me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ©</h6>
                                        <p class="mb-0 small">Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Ù…Ø­Ù„Ùƒ</p>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                                                <label>Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„) *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="productQuantity" min="0" required>
                                                <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø© *</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Auto-generated Preview -->
                                    <div class="alert alert-info">
                                        <h6><i class="fas fa-eye me-2"></i>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙ†Ù</h6>
                                        <div id="productPreview">
                                            <strong>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</strong> <span id="previewName">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span><br>
                                            <strong>Ø§Ù„ÙˆØµÙ:</strong> <span id="previewDescription">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>
                                        </div>
                                    </div>
                                </form>

                                <div class="alert alert-info mt-3">
                                    <h6><i class="fas fa-lightbulb me-2"></i>Ù†ØµÙŠØ­Ø©:</h6>
                                    <p class="mb-0">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù…Ø­Ù„Ùƒ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù"ØŒ Ø«Ù… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</p>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="me-auto">
                                    <button type="button" class="btn btn-outline-info" onclick="addAllProductsToShop()" title="Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…">
                                        <i class="fas fa-plus-circle me-2"></i>
                                        Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù
                                    </button>
                                </div>
                                <div>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                                    <button type="button" class="btn btn-primary" onclick="addProduct()">
                                        <i class="fas fa-save me-2"></i>
                                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalsContainer').innerHTML = modal;
            const modalElement = new bootstrap.Modal(document.getElementById('addProductModal'));
            modalElement.show();

            // Add event listeners after modal is shown
            setTimeout(() => {
                addProductFormListeners();
                updateProductPreview();
            }, 100);
        }

        // Add product
        function addProduct() {
            console.log('ğŸ“¦ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯...');

            // Check if elements exist
            const requiredElements = ['carBrand', 'carModel', 'carYear', 'productName', 'productDescription', 'partNumber', 'productCategory', 'productPrice', 'productQuantity'];
            for (let elementId of requiredElements) {
                const element = document.getElementById(elementId);
                if (!element) {
                    console.error(`âŒ Ø§Ù„Ø¹Ù†ØµØ± ${elementId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
                    showNotification(`Ø®Ø·Ø£: Ø§Ù„Ø¹Ù†ØµØ± ${elementId} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`, 'danger');
                    return;
                }
            }

            const productData = {
                carBrand: document.getElementById('carBrand').value,
                carModel: document.getElementById('carModel').value,
                carYear: document.getElementById('carYear').value,
                name: document.getElementById('productName').value.trim(),
                description: document.getElementById('productDescription').value.trim(),
                partNumber: document.getElementById('partNumber').value.trim(),
                category: document.getElementById('productCategory').value,
                brand: document.getElementById('carBrand').value, // Use car brand as product brand
                model: document.getElementById('carModel').value + (document.getElementById('carYear').value ? ' ' + document.getElementById('carYear').value : ''), // Combine model and year
                price: parseFloat(document.getElementById('productPrice').value),
                quantity: parseInt(document.getElementById('productQuantity').value)
            };

            console.log('ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:', productData);

            // Validation
            if (!productData.carBrand || !productData.carModel || !productData.carYear || !productData.name ||
                isNaN(productData.price) || productData.price < 0 || isNaN(productData.quantity) || productData.quantity < 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ Ø§Ù„Ù…Ø§Ø±ÙƒØ©ØŒ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ØŒ Ø§Ø³Ù… Ø§Ù„ØµÙ†ÙØŒ Ø§Ù„Ø³Ø¹Ø± â‰¥ 0ØŒ Ø§Ù„ÙƒÙ…ÙŠØ© â‰¥ 0', 'warning');
                return;
            }

            // Check if product exists
            const existingProduct = products.find(p =>
                p.name.toLowerCase() === productData.name.toLowerCase() &&
                p.partNumber === productData.partNumber
            );

            if (existingProduct) {
                // Add to existing product
                const shopDetail = existingProduct.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                if (shopDetail) {
                    showNotification('Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù…Ø­Ù„Ùƒ', 'warning');
                    return;
                }

                existingProduct.shopDetails.push({
                    shopName: currentUser.name,
                    shopId: currentUser.shopId,
                    price: productData.price,
                    quantity: productData.quantity
                });

                showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ "${productData.name}" Ø¥Ù„Ù‰ Ù…Ø­Ù„Ùƒ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            } else {
                // Create new product
                const newProduct = {
                    id: nextProductId++,
                    name: productData.name,
                    description: productData.description,
                    partNumber: productData.partNumber,
                    category: productData.category,
                    brand: productData.brand,
                    model: productData.model,
                    shopDetails: [{
                        shopName: currentUser.name,
                        shopId: currentUser.shopId,
                        price: productData.price,
                        quantity: productData.quantity
                    }]
                };

                products.push(newProduct);
                showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ "${productData.name}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
            }

            // Save to localStorage
            saveToStorage();
            console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬');

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
            if (modal) {
                modal.hide();
                console.log('âŒ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†ØªØ¬');
            }

            // Refresh current page
            if (document.getElementById('dashboard').classList.contains('active')) {
                loadDashboard();
            } else if (document.getElementById('home').classList.contains('active')) {
                loadData();
            }
        }

        // Car models data
        const carModels = {
            'ØªÙˆÙŠÙˆØªØ§': ['ÙƒØ§Ù…Ø±ÙŠ', 'ÙƒÙˆØ±ÙˆÙ„Ø§', 'ÙŠØ§Ø±Ø³', 'Ø£ÙØ§Ù„ÙˆÙ†', 'Ù‡Ø§ÙŠÙ„Ø§Ù†Ø¯Ø±', 'Ø±Ø§Ù 4', 'Ø¨Ø±Ø§Ø¯Ùˆ', 'Ù„Ø§Ù†Ø¯ ÙƒØ±ÙˆØ²Ø±', 'Ø³ÙŠÙƒÙˆÙŠØ§', 'ØªØ§ÙƒÙˆÙ…Ø§', 'ØªÙ†Ø¯Ø±Ø§'],
            'Ù‡ÙˆÙ†Ø¯Ø§': ['Ø£ÙƒÙˆØ±Ø¯', 'Ø³ÙŠÙÙŠÙƒ', 'Ø³ÙŠØªÙŠ', 'Ø³ÙŠ Ø¢Ø± ÙÙŠ', 'Ø¨Ø§ÙŠÙ„ÙˆØª', 'Ø±ÙŠØ¯Ø¬ Ù„Ø§ÙŠÙ†', 'Ø£ÙˆØ¯ÙŠØ³ÙŠ', 'ÙÙŠØª', 'Ø¥Ù†Ø³Ø§ÙŠØª'],
            'Ù†ÙŠØ³Ø§Ù†': ['Ø§Ù„ØªÙŠÙ…Ø§', 'Ø³Ù†ØªØ±Ø§', 'Ù…ÙƒØ³ÙŠÙ…Ø§', 'Ø¨Ø§Ø«ÙØ§ÙŠÙ†Ø¯Ø±', 'Ù…ÙˆØ±Ø§Ù†Ùˆ', 'Ø±ÙˆØ¬', 'Ø£Ø±Ù…Ø§Ø¯Ø§', 'ØªÙŠØªØ§Ù†', 'ÙÙŠØ±Ø³Ø§', 'Ø¬ÙˆÙƒ'],
            'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ': ['Ø¥Ù„Ù†ØªØ±Ø§', 'Ø³ÙˆÙ†Ø§ØªØ§', 'Ø£ÙƒØ³Ù†Øª', 'ØªÙˆØ³Ø§Ù†', 'Ø³Ø§Ù†ØªØ§ ÙÙŠ', 'ÙƒÙˆÙ†Ø§', 'Ø¨Ø§Ù„ÙŠØ³ÙŠØ¯', 'ÙÙŠÙ„ÙˆØ³ØªØ±', 'Ø£ÙŠÙˆÙ†ÙŠÙƒ'],
            'ÙƒÙŠØ§': ['Ø£ÙˆØ¨ØªÙŠÙ…Ø§', 'ÙÙˆØ±ØªÙŠ', 'Ø±ÙŠÙˆ', 'Ø³ÙˆØ±ÙŠÙ†ØªÙˆ', 'Ø³Ø¨ÙˆØ±ØªØ§Ø¬', 'ØªÙŠÙ„ÙˆØ±Ø§ÙŠØ¯', 'Ø³ØªÙŠÙ†Ø¬Ø±', 'Ø³ÙˆÙ„', 'Ù†ÙŠØ±Ùˆ'],
            'Ù…Ø§Ø²Ø¯Ø§': ['Ù…Ø§Ø²Ø¯Ø§ 3', 'Ù…Ø§Ø²Ø¯Ø§ 6', 'Ù…Ø§Ø²Ø¯Ø§ 2', 'Ø³ÙŠ Ø¥ÙƒØ³ 5', 'Ø³ÙŠ Ø¥ÙƒØ³ 9', 'Ø³ÙŠ Ø¥ÙƒØ³ 3', 'Ø¥Ù… Ø¥ÙƒØ³ 5'],
            'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ': ['Ù„Ø§Ù†Ø³Ø±', 'Ø£ÙˆØªÙ„Ø§Ù†Ø¯Ø±', 'Ø¥ÙƒÙ„ÙŠØ¨Ø³ ÙƒØ±ÙˆØ³', 'Ù…ÙˆÙ†ØªÙŠØ±Ùˆ', 'Ù…ÙŠØ±Ø§Ø¬', 'Ø£ÙŠ Ø¥Ø³ Ø¥ÙƒØ³'],
            'Ø³ÙˆØ²ÙˆÙƒÙŠ': ['Ø³ÙˆÙŠÙØª', 'Ø¨Ø§Ù„ÙŠÙ†Ùˆ', 'ÙÙŠØªØ§Ø±Ø§', 'Ø¬ÙŠÙ…Ù†ÙŠ', 'Ø¥Ø±ØªÙŠØ¬Ø§', 'Ø³ÙŠØ§Ø²'],
            'ÙÙˆØ±Ø¯': ['ÙÙŠÙˆØ¬Ù†', 'ÙÙˆÙƒØ³', 'ÙÙŠÙŠØ³ØªØ§', 'Ø¥ÙƒØ³Ø¨Ù„ÙˆØ±Ø±', 'Ø¥ÙƒØ³Ø¨ÙŠØ¯ÙŠØ´Ù†', 'Ø¥Ù 150', 'Ù…ÙˆØ³ØªØ§Ù†Ø¬', 'Ø¥ÙŠØ¯Ø¬'],
            'Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡': ['ÙƒØ±ÙˆØ²', 'Ù…Ø§Ù„ÙŠØ¨Ùˆ', 'Ø¥Ù…Ø¨Ø§Ù„Ø§', 'Ø¥ÙƒÙˆÙŠÙ†ÙˆÙƒØ³', 'ØªØ§Ù‡Ùˆ', 'Ø³ÙˆØ¨Ø±Ø¨Ø§Ù†', 'Ø³ÙŠÙ„ÙØ±Ø§Ø¯Ùˆ', 'ÙƒØ§Ù…Ø§Ø±Ùˆ'],
            'Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ': ['Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©', 'Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©', 'Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©', 'Ø¥ÙƒØ³ 1', 'Ø¥ÙƒØ³ 3', 'Ø¥ÙƒØ³ 5', 'Ø¥ÙƒØ³ 7'],
            'Ù…Ø±Ø³ÙŠØ¯Ø³': ['Ø§Ù„ÙØ¦Ø© Ø³ÙŠ', 'Ø§Ù„ÙØ¦Ø© Ø¥ÙŠ', 'Ø§Ù„ÙØ¦Ø© Ø¥Ø³', 'Ø¬ÙŠ Ø¥Ù„ Ø¥ÙŠÙ‡', 'Ø¬ÙŠ Ø¥Ù„ Ø³ÙŠ', 'Ø¬ÙŠ Ø¥Ù„ Ø¥ÙŠ', 'Ø¬ÙŠ Ø¥Ù„ Ø¥Ø³'],
            'Ø£ÙˆØ¯ÙŠ': ['Ø¥ÙŠÙ‡ 3', 'Ø¥ÙŠÙ‡ 4', 'Ø¥ÙŠÙ‡ 6', 'Ø¥ÙŠÙ‡ 8', 'ÙƒÙŠÙˆ 3', 'ÙƒÙŠÙˆ 5', 'ÙƒÙŠÙˆ 7', 'ÙƒÙŠÙˆ 8'],
            'ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†': ['Ø¬ÙŠØªØ§', 'Ø¨Ø§Ø³Ø§Øª', 'Ø¬ÙˆÙ„Ù', 'ØªÙŠØ¬ÙˆØ§Ù†', 'Ø£Ø·Ù„Ø³', 'Ø£Ø±ØªÙŠÙˆÙ†', 'Ø¨ÙˆÙ„Ùˆ'],
            'Ù„ÙƒØ²Ø³': ['Ø¥ÙŠ Ø¥Ø³', 'Ø¢ÙŠ Ø¥Ø³', 'Ø¬ÙŠ Ø¥Ø³', 'Ø¥Ù„ Ø¥Ø³', 'Ø¥Ù† Ø¥ÙƒØ³', 'Ø¢Ø± Ø¥ÙƒØ³', 'Ø¬ÙŠ Ø¥ÙƒØ³', 'Ø¥Ù„ Ø¥ÙƒØ³'],
            'Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ': ['ÙƒÙŠÙˆ 50', 'ÙƒÙŠÙˆ 60', 'ÙƒÙŠÙˆ Ø¥ÙƒØ³ 50', 'ÙƒÙŠÙˆ Ø¥ÙƒØ³ 60', 'ÙƒÙŠÙˆ Ø¥ÙƒØ³ 80'],
            'Ø£ÙƒÙˆØ±Ø§': ['Ø¢ÙŠ Ø¥Ù„ Ø¥ÙƒØ³', 'ØªÙŠ Ø¥Ù„ Ø¥ÙƒØ³', 'Ø¢Ø± Ø¥Ù„ Ø¥ÙƒØ³', 'Ø¢Ø± Ø¯ÙŠ Ø¥ÙƒØ³', 'Ø¥Ù… Ø¯ÙŠ Ø¥ÙƒØ³'],
            'Ø¹Ø§Ù…': ['Ø¹Ø§Ù…']
        };

        // Update car models based on selected brand
        function updateCarModels() {
            const carBrand = document.getElementById('carBrand').value;
            const carModelSelect = document.getElementById('carModel');

            // Clear existing options
            carModelSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©</option>';

            if (carBrand && carModels[carBrand]) {
                carModels[carBrand].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    carModelSelect.appendChild(option);
                });
            }

            // Update product preview
            updateProductPreview();
        }

        // Update product preview
        function updateProductPreview() {
            const carBrand = document.getElementById('carBrand').value;
            const carModel = document.getElementById('carModel').value;
            const carYear = document.getElementById('carYear').value;
            const partNumber = document.getElementById('partNumber').value;
            const category = document.getElementById('productCategory').value;
            const productName = document.getElementById('productName').value;

            let generatedName = '';
            let generatedDescription = '';

            // Generate name based on inputs
            if (category) {
                generatedName += category + ' ';
            }

            if (carBrand && carBrand !== 'Ø¹Ø§Ù…') {
                generatedName += carBrand + ' ';
            }

            if (carModel && carModel !== 'Ø¹Ø§Ù…') {
                generatedName += carModel + ' ';
            }

            if (carYear && carYear !== 'Ø¹Ø§Ù…') {
                generatedName += carYear + ' ';
            }

            if (productName) {
                generatedName += productName;
            } else {
                generatedName += 'Ù‚Ø·Ø¹Ø© ØºÙŠØ§Ø±';
            }

            // Generate description
            generatedDescription = `Ù‚Ø·Ø¹Ø© ØºÙŠØ§Ø± ${category || 'Ø£ØµÙ„ÙŠØ©'}`;
            if (carBrand && carBrand !== 'Ø¹Ø§Ù…') {
                generatedDescription += ` Ù„Ø³ÙŠØ§Ø±Ø© ${carBrand}`;
            }
            if (carModel && carModel !== 'Ø¹Ø§Ù…') {
                generatedDescription += ` ${carModel}`;
            }
            if (carYear && carYear !== 'Ø¹Ø§Ù…') {
                generatedDescription += ` Ù…ÙˆØ¯ÙŠÙ„ ${carYear}`;
            }
            if (partNumber) {
                generatedDescription += ` - Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${partNumber}`;
            }

            // Update preview
            document.getElementById('previewName').textContent = generatedName.trim() || 'Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';
            document.getElementById('previewDescription').textContent = generatedDescription || 'Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹';

            // Auto-fill the product name if empty
            if (!document.getElementById('productName').value) {
                document.getElementById('productName').value = generatedName.trim();
            }

            // Auto-fill the description if empty
            if (!document.getElementById('productDescription').value) {
                document.getElementById('productDescription').value = generatedDescription;
            }
        }

        // Add event listeners for real-time preview updates
        function addProductFormListeners() {
            const fields = ['carBrand', 'carModel', 'carYear', 'partNumber', 'productCategory', 'productName'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', updateProductPreview);
                    field.addEventListener('input', updateProductPreview);
                }
            });
        }

        // Update edit car models based on selected brand
        function updateEditCarModels() {
            const carBrand = document.getElementById('editCarBrand')?.value;
            const carModelSelect = document.getElementById('editCarModel');

            if (!carModelSelect) return;

            // Store current selection
            const currentSelection = carModelSelect.value;

            // Clear existing options
            carModelSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©</option>';

            if (carBrand && carModels[carBrand]) {
                carModels[carBrand].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    if (model === currentSelection) {
                        option.selected = true;
                    }
                    carModelSelect.appendChild(option);
                });
            }

            // Update preview
            updateEditProductPreview();
        }

        // Update edit product preview
        function updateEditProductPreview() {
            const carBrand = document.getElementById('editCarBrand')?.value || '';
            const carModel = document.getElementById('editCarModel')?.value || '';
            const carYear = document.getElementById('editCarYear')?.value || '';
            const partNumber = document.getElementById('editPartNumber')?.value || '';
            const category = document.getElementById('editProductCategory')?.value || '';
            const productName = document.getElementById('editProductName')?.value || '';
            const productDescription = document.getElementById('editProductDescription')?.value || '';

            let generatedName = '';
            let generatedDescription = '';
            let carInfo = '';

            // Generate name based on inputs
            if (category) {
                generatedName += category + ' ';
            }

            if (carBrand && carBrand !== 'Ø¹Ø§Ù…') {
                generatedName += carBrand + ' ';
                carInfo += carBrand;
            }

            if (carModel && carModel !== 'Ø¹Ø§Ù…') {
                generatedName += carModel + ' ';
                carInfo += ' ' + carModel;
            }

            if (carYear && carYear !== 'Ø¹Ø§Ù…') {
                generatedName += carYear + ' ';
                carInfo += ' ' + carYear;
            }

            // Use current name or generated name
            if (!productName && generatedName) {
                generatedName += 'Ù‚Ø·Ø¹Ø© ØºÙŠØ§Ø±';
            } else if (productName) {
                generatedName = productName;
            }

            // Generate description
            if (!productDescription && (carBrand || category)) {
                generatedDescription = `Ù‚Ø·Ø¹Ø© ØºÙŠØ§Ø± ${category || 'Ø£ØµÙ„ÙŠØ©'}`;
                if (carBrand && carBrand !== 'Ø¹Ø§Ù…') {
                    generatedDescription += ` Ù„Ø³ÙŠØ§Ø±Ø© ${carBrand}`;
                }
                if (carModel && carModel !== 'Ø¹Ø§Ù…') {
                    generatedDescription += ` ${carModel}`;
                }
                if (carYear && carYear !== 'Ø¹Ø§Ù…') {
                    generatedDescription += ` Ù…ÙˆØ¯ÙŠÙ„ ${carYear}`;
                }
                if (partNumber) {
                    generatedDescription += ` - Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©: ${partNumber}`;
                }
            } else if (productDescription) {
                generatedDescription = productDescription;
            }

            // Update preview
            const previewName = document.getElementById('editPreviewName');
            const previewDescription = document.getElementById('editPreviewDescription');
            const previewCar = document.getElementById('editPreviewCar');

            if (previewName) previewName.textContent = generatedName || 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬';
            if (previewDescription) previewDescription.textContent = generatedDescription || 'ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬';
            if (previewCar) previewCar.textContent = carInfo.trim() || 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©';
        }

        // Add event listeners for edit form
        function addEditProductFormListeners() {
            const fields = ['editCarBrand', 'editCarModel', 'editCarYear', 'editPartNumber', 'editProductCategory', 'editProductName', 'editProductDescription'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('change', updateEditProductPreview);
                    field.addEventListener('input', updateEditProductPreview);
                }
            });
        }

        // Update shop product with all fields
        function updateShopProduct(productId) {
            console.log('ğŸ“ Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬:', productId);

            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
            if (!shopDetail) {
                showNotification('Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù…Ø­Ù„Ùƒ', 'warning');
                return;
            }

            // Get all form data
            const formData = {
                carBrand: document.getElementById('editCarBrand').value,
                carModel: document.getElementById('editCarModel').value,
                carYear: document.getElementById('editCarYear').value,
                partNumber: document.getElementById('editPartNumber').value.trim(),
                category: document.getElementById('editProductCategory').value,
                name: document.getElementById('editProductName').value.trim(),
                description: document.getElementById('editProductDescription').value.trim(),
                price: parseFloat(document.getElementById('editProductPrice').value),
                quantity: parseInt(document.getElementById('editProductQuantity').value)
            };

            console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', formData);

            // Validation
            if (!formData.carBrand || !formData.carModel || !formData.carYear || !formData.name ||
                isNaN(formData.price) || formData.price < 0 || isNaN(formData.quantity) || formData.quantity < 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©', 'warning');
                return;
            }

            // Update product information (affects all shops)
            product.brand = formData.carBrand;
            product.model = formData.carModel + (formData.carYear && formData.carYear !== 'Ø¹Ø§Ù…' ? ' ' + formData.carYear : '');
            product.partNumber = formData.partNumber;
            product.category = formData.category;
            product.name = formData.name;
            product.description = formData.description;

            // Update shop-specific information
            shopDetail.price = formData.price;
            shopDetail.quantity = formData.quantity;

            // Update shop name in all product details if shop name changed
            shopDetail.shopName = currentUser.name;

            // Save to localStorage
            saveToStorage();
            console.log('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª');

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
            if (modal) {
                modal.hide();
            }

            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ "${formData.name}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');

            // Refresh current page
            if (document.getElementById('dashboard').classList.contains('active')) {
                loadDashboard();
            } else if (document.getElementById('home').classList.contains('active')) {
                loadData();
            }

            console.log('âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬');
        }

        // Add all products to current shop
        function addAllProductsToShop() {
            if (!currentUser || currentUser.role !== 'shop') {
                showNotification('Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø­Ù„Ø§Øª ÙÙ‚Ø·', 'warning');
                return;
            }

            // Count products that will be added
            let productsToAdd = 0;
            let productsAlreadyExists = 0;

            products.forEach(product => {
                const existingShopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                if (!existingShopDetail) {
                    productsToAdd++;
                } else {
                    productsAlreadyExists++;
                }
            });

            if (productsToAdd === 0) {
                showNotification('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù…Ø­Ù„Ùƒ!', 'info');
                return;
            }

            // Show confirmation with details
            const confirmMessage = `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù Ù„Ù…Ø­Ù„ÙƒØŸ\n\n` +
                `Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ©: ${productsToAdd} Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯\n` +
                `Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„: ${productsAlreadyExists} Ù…Ù†ØªØ¬\n\n` +
                `Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ØªØ¨Ø¯Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨ÙƒÙ…ÙŠØ© 0 ÙˆØ£Ø³Ø¹Ø§Ø± Ù…ØªÙˆØ³Ø·Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….`;

            if (!confirm(confirmMessage)) return;

            let addedCount = 0;

            // Add missing products to the shop
            products.forEach(product => {
                const existingShopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                if (!existingShopDetail) {
                    // Calculate average price from existing shops for reference
                    const existingPrices = product.shopDetails.map(shop => shop.price);
                    const avgPrice = existingPrices.length > 0 ?
                        Math.round(existingPrices.reduce((sum, price) => sum + price, 0) / existingPrices.length) : 100;

                    // Add this shop to the product with default values
                    product.shopDetails.push({
                        shopName: currentUser.name,
                        shopId: currentUser.shopId,
                        price: avgPrice, // Use average price as starting point
                        quantity: 0 // Start with 0 quantity - shop owner will update
                    });

                    addedCount++;
                }
            });

            // Save to localStorage
            saveToStorage();

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
            if (modal) {
                modal.hide();
            }

            // Show success message
            showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${addedCount} Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù…Ø­Ù„Ùƒ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');

            setTimeout(() => {
                showNotification('ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ§Øª Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'info');
            }, 1500);

            setTimeout(() => {
                showNotification(`ØªÙØ§ØµÙŠÙ„: Ø£Ø¶ÙŠÙ ${addedCount} Ù…Ù†ØªØ¬ØŒ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ${productsAlreadyExists} Ù…Ù†ØªØ¬`, 'info');
            }, 2500);

            // Refresh dashboard if currently viewing
            if (document.getElementById('dashboard').classList.contains('active')) {
                setTimeout(() => {
                    loadDashboard();
                }, 500);
            }

            // Refresh home page data if viewing
            if (document.getElementById('home').classList.contains('active')) {
                setTimeout(() => {
                    loadData();
                }, 500);
            }
        }

        // Other functions
        function showProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            const totalQuantity = product.shopDetails.reduce((sum, shop) => sum + shop.quantity, 0);
            const availableShops = product.shopDetails.filter(shop => shop.quantity > 0).length;
            const avgPrice = product.shopDetails.reduce((sum, shop) => sum + shop.price, 0) / product.shopDetails.length;

            // Extract car information
            const carBrand = product.brand || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            let carModel = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            let carYear = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            if (product.model && product.model.trim()) {
                const modelText = product.model.trim();
                const yearMatch = modelText.match(/\d{4}/);
                if (yearMatch) {
                    carYear = yearMatch[0];
                    carModel = modelText.replace(/\s*\d{4}\s*/, '').trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                } else {
                    carModel = modelText;
                }
            }

            const modal = `
                <div class="modal fade" id="productDetailModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-cog me-2"></i>
                                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬: ${product.name}
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Product Information -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h6>
                                            </div>
                                            <div class="card-body">
                                                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${product.name}</p>
                                                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©:</strong> ${product.partNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                                <p><strong>Ø§Ù„ÙØ¦Ø©:</strong> ${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                                <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${product.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header bg-light">
                                                <h6 class="mb-0"><i class="fas fa-car me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h6>
                                            </div>
                                            <div class="card-body">
                                                <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong>
                                                    <span class="badge bg-primary">${carBrand}</span>
                                                </p>
                                                <p><strong>Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong>
                                                    <span class="badge bg-info">${carModel}</span>
                                                </p>
                                                <p><strong>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong>
                                                    <span class="badge bg-warning text-dark">${carYear}</span>
                                                </p>
                                                <p><strong>Ø§Ù„ØªÙˆØ§ÙÙ‚:</strong> ${carBrand} ${carModel} ${carYear}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Statistics -->
                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <div class="card bg-primary text-white text-center">
                                            <div class="card-body">
                                                <h4>${product.shopDetails.length}</h4>
                                                <p class="mb-0">Ù…Ø­Ù„</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-success text-white text-center">
                                            <div class="card-body">
                                                <h4>${availableShops}</h4>
                                                <p class="mb-0">Ù…ØªÙˆÙØ±</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-info text-white text-center">
                                            <div class="card-body">
                                                <h4>${totalQuantity}</h4>
                                                <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card bg-warning text-dark text-center">
                                            <div class="card-body">
                                                <h4>${Math.round(avgPrice)} Ø±ÙŠØ§Ù„</h4>
                                                <p class="mb-0">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Shops Table -->
                                <h6><i class="fas fa-store me-2"></i>Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</h6>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Ø§Ù„Ù…Ø­Ù„</th>
                                                <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                                <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${product.shopDetails.map(shop => {
                                                const totalValue = shop.price * shop.quantity;
                                                const isAvailable = shop.quantity > 0;

                                                return `
                                                    <tr>
                                                        <td><strong>${shop.shopName}</strong></td>
                                                        <td><span class="fw-bold text-primary">${shop.price} Ø±ÙŠØ§Ù„</span></td>
                                                        <td>
                                                            <span class="badge ${isAvailable ? 'bg-success' : 'bg-danger'}">
                                                                ${shop.quantity}
                                                            </span>
                                                        </td>
                                                        <td><strong>${Math.round(totalValue)} Ø±ÙŠØ§Ù„</strong></td>
                                                        <td>
                                                            <span class="badge ${isAvailable ? 'bg-success' : 'bg-danger'}">
                                                                ${isAvailable ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalsContainer').innerHTML = modal;
            const modalElement = new bootstrap.Modal(document.getElementById('productDetailModal'));
            modalElement.show();
        }

        function deleteProduct(productId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;

            const productIndex = products.findIndex(p => p.id === productId);
            if (productIndex > -1) {
                const productName = products[productIndex].name;
                products.splice(productIndex, 1);

                // Save to localStorage
                saveToStorage();

                showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${productName}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');

                // Refresh current page
                if (document.getElementById('dashboard').classList.contains('active')) {
                    loadDashboard();
                } else if (document.getElementById('home').classList.contains('active')) {
                    loadData();
                }
            }
        }

        function editShopProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
            if (!shopDetail) {
                showNotification('Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù…Ø­Ù„Ùƒ', 'warning');
                return;
            }

            // Extract current car information
            let currentCarBrand = product.brand || '';
            let currentCarModel = '';
            let currentCarYear = '';

            if (product.model && product.model.trim()) {
                const modelText = product.model.trim();
                const yearMatch = modelText.match(/\d{4}/);
                if (yearMatch) {
                    currentCarYear = yearMatch[0];
                    currentCarModel = modelText.replace(/\s*\d{4}\s*/, '').trim();
                } else {
                    currentCarModel = modelText;
                }
            }

            const modal = `
                <div class="modal fade" id="editProductModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-dark">
                                <h5 class="modal-title">
                                    <i class="fas fa-edit me-2"></i>
                                    ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬: ${product.name}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editProductForm">
                                    <!-- Car Information Section -->
                                    <div class="alert alert-primary">
                                        <h6><i class="fas fa-car me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h6>
                                        <p class="mb-0 small">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬</p>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="editCarBrand" onchange="updateEditCarModels()" required>
                                                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</option>
                                                    <option value="ØªÙˆÙŠÙˆØªØ§" ${currentCarBrand === 'ØªÙˆÙŠÙˆØªØ§' ? 'selected' : ''}>ØªÙˆÙŠÙˆØªØ§</option>
                                                    <option value="Ù‡ÙˆÙ†Ø¯Ø§" ${currentCarBrand === 'Ù‡ÙˆÙ†Ø¯Ø§' ? 'selected' : ''}>Ù‡ÙˆÙ†Ø¯Ø§</option>
                                                    <option value="Ù†ÙŠØ³Ø§Ù†" ${currentCarBrand === 'Ù†ÙŠØ³Ø§Ù†' ? 'selected' : ''}>Ù†ÙŠØ³Ø§Ù†</option>
                                                    <option value="Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ" ${currentCarBrand === 'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ' ? 'selected' : ''}>Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ</option>
                                                    <option value="ÙƒÙŠØ§" ${currentCarBrand === 'ÙƒÙŠØ§' ? 'selected' : ''}>ÙƒÙŠØ§</option>
                                                    <option value="Ù…Ø§Ø²Ø¯Ø§" ${currentCarBrand === 'Ù…Ø§Ø²Ø¯Ø§' ? 'selected' : ''}>Ù…Ø§Ø²Ø¯Ø§</option>
                                                    <option value="Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ" ${currentCarBrand === 'Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ' ? 'selected' : ''}>Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ</option>
                                                    <option value="Ø³ÙˆØ²ÙˆÙƒÙŠ" ${currentCarBrand === 'Ø³ÙˆØ²ÙˆÙƒÙŠ' ? 'selected' : ''}>Ø³ÙˆØ²ÙˆÙƒÙŠ</option>
                                                    <option value="ÙÙˆØ±Ø¯" ${currentCarBrand === 'ÙÙˆØ±Ø¯' ? 'selected' : ''}>ÙÙˆØ±Ø¯</option>
                                                    <option value="Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡" ${currentCarBrand === 'Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡' ? 'selected' : ''}>Ø´ÙŠÙØ±ÙˆÙ„ÙŠÙ‡</option>
                                                    <option value="Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ" ${currentCarBrand === 'Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ' ? 'selected' : ''}>Ø¨ÙŠ Ø¥Ù… Ø¯Ø¨Ù„ÙŠÙˆ</option>
                                                    <option value="Ù…Ø±Ø³ÙŠØ¯Ø³" ${currentCarBrand === 'Ù…Ø±Ø³ÙŠØ¯Ø³' ? 'selected' : ''}>Ù…Ø±Ø³ÙŠØ¯Ø³</option>
                                                    <option value="Ø£ÙˆØ¯ÙŠ" ${currentCarBrand === 'Ø£ÙˆØ¯ÙŠ' ? 'selected' : ''}>Ø£ÙˆØ¯ÙŠ</option>
                                                    <option value="ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†" ${currentCarBrand === 'ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†' ? 'selected' : ''}>ÙÙˆÙ„ÙƒØ³ ÙˆØ§Ø¬Ù†</option>
                                                    <option value="Ù„ÙƒØ²Ø³" ${currentCarBrand === 'Ù„ÙƒØ²Ø³' ? 'selected' : ''}>Ù„ÙƒØ²Ø³</option>
                                                    <option value="Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ" ${currentCarBrand === 'Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ' ? 'selected' : ''}>Ø¥Ù†ÙÙŠÙ†ÙŠØªÙŠ</option>
                                                    <option value="Ø£ÙƒÙˆØ±Ø§" ${currentCarBrand === 'Ø£ÙƒÙˆØ±Ø§' ? 'selected' : ''}>Ø£ÙƒÙˆØ±Ø§</option>
                                                    <option value="Ø¹Ø§Ù…" ${currentCarBrand === 'Ø¹Ø§Ù…' ? 'selected' : ''}>Ø¹Ø§Ù… (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª)</option>
                                                </select>
                                                <label>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="editCarModel" required>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø±ÙƒØ©</option>
                                                </select>
                                                <label>Ø§Ù„Ù…Ø§Ø±ÙƒØ© *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="editCarYear" required>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</option>
                                                    <option value="2024" ${currentCarYear === '2024' ? 'selected' : ''}>2024</option>
                                                    <option value="2023" ${currentCarYear === '2023' ? 'selected' : ''}>2023</option>
                                                    <option value="2022" ${currentCarYear === '2022' ? 'selected' : ''}>2022</option>
                                                    <option value="2021" ${currentCarYear === '2021' ? 'selected' : ''}>2021</option>
                                                    <option value="2020" ${currentCarYear === '2020' ? 'selected' : ''}>2020</option>
                                                    <option value="2019" ${currentCarYear === '2019' ? 'selected' : ''}>2019</option>
                                                    <option value="2018" ${currentCarYear === '2018' ? 'selected' : ''}>2018</option>
                                                    <option value="2017" ${currentCarYear === '2017' ? 'selected' : ''}>2017</option>
                                                    <option value="2016" ${currentCarYear === '2016' ? 'selected' : ''}>2016</option>
                                                    <option value="2015" ${currentCarYear === '2015' ? 'selected' : ''}>2015</option>
                                                    <option value="2014" ${currentCarYear === '2014' ? 'selected' : ''}>2014</option>
                                                    <option value="2013" ${currentCarYear === '2013' ? 'selected' : ''}>2013</option>
                                                    <option value="2012" ${currentCarYear === '2012' ? 'selected' : ''}>2012</option>
                                                    <option value="2011" ${currentCarYear === '2011' ? 'selected' : ''}>2011</option>
                                                    <option value="2010" ${currentCarYear === '2010' ? 'selected' : ''}>2010</option>
                                                    <option value="2009" ${currentCarYear === '2009' ? 'selected' : ''}>2009</option>
                                                    <option value="2008" ${currentCarYear === '2008' ? 'selected' : ''}>2008</option>
                                                    <option value="2007" ${currentCarYear === '2007' ? 'selected' : ''}>2007</option>
                                                    <option value="2006" ${currentCarYear === '2006' ? 'selected' : ''}>2006</option>
                                                    <option value="2005" ${currentCarYear === '2005' ? 'selected' : ''}>2005</option>
                                                    <option value="2004" ${currentCarYear === '2004' ? 'selected' : ''}>2004</option>
                                                    <option value="2003" ${currentCarYear === '2003' ? 'selected' : ''}>2003</option>
                                                    <option value="2002" ${currentCarYear === '2002' ? 'selected' : ''}>2002</option>
                                                    <option value="2001" ${currentCarYear === '2001' ? 'selected' : ''}>2001</option>
                                                    <option value="2000" ${currentCarYear === '2000' ? 'selected' : ''}>2000</option>
                                                    <option value="Ø¹Ø§Ù…" ${currentCarYear === 'Ø¹Ø§Ù…' ? 'selected' : ''}>Ø¹Ø§Ù…</option>
                                                </select>
                                                <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ø§Ù„Ø³Ù†Ø©) *</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Product Information Section -->
                                    <div class="alert alert-success">
                                        <h6><i class="fas fa-cog me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚Ø·Ø¹Ø©</h6>
                                        <p class="mb-0 small">ØªÙØ§ØµÙŠÙ„ Ù‚Ø·Ø¹Ø© Ø§Ù„ØºÙŠØ§Ø±</p>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="editPartNumber" value="${product.partNumber || ''}">
                                                <label>ÙƒÙˆØ¯ Ø§Ù„ØµÙ†Ù / Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="editProductCategory">
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                                                    <option value="ÙÙ„Ø§ØªØ±" ${product.category === 'ÙÙ„Ø§ØªØ±' ? 'selected' : ''}>ÙÙ„Ø§ØªØ±</option>
                                                    <option value="ÙØ±Ø§Ù…Ù„" ${product.category === 'ÙØ±Ø§Ù…Ù„' ? 'selected' : ''}>ÙØ±Ø§Ù…Ù„</option>
                                                    <option value="Ø²ÙŠÙˆØª" ${product.category === 'Ø²ÙŠÙˆØª' ? 'selected' : ''}>Ø²ÙŠÙˆØª</option>
                                                    <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡" ${product.category === 'ÙƒÙ‡Ø±Ø¨Ø§Ø¡' ? 'selected' : ''}>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                                                    <option value="Ø¥Ø·Ø§Ø±Ø§Øª" ${product.category === 'Ø¥Ø·Ø§Ø±Ø§Øª' ? 'selected' : ''}>Ø¥Ø·Ø§Ø±Ø§Øª</option>
                                                    <option value="Ù…Ø­Ø±Ùƒ" ${product.category === 'Ù…Ø­Ø±Ùƒ' ? 'selected' : ''}>Ù…Ø­Ø±Ùƒ</option>
                                                    <option value="ØªÙƒÙŠÙŠÙ" ${product.category === 'ØªÙƒÙŠÙŠÙ' ? 'selected' : ''}>ØªÙƒÙŠÙŠÙ</option>
                                                    <option value="Ø¹Ø§Ø¯Ù…" ${product.category === 'Ø¹Ø§Ø¯Ù…' ? 'selected' : ''}>Ø¹Ø§Ø¯Ù…</option>
                                                    <option value="ØªØ¹Ù„ÙŠÙ‚" ${product.category === 'ØªØ¹Ù„ÙŠÙ‚' ? 'selected' : ''}>ØªØ¹Ù„ÙŠÙ‚</option>
                                                    <option value="ØªÙˆØ¬ÙŠÙ‡" ${product.category === 'ØªÙˆØ¬ÙŠÙ‡' ? 'selected' : ''}>ØªÙˆØ¬ÙŠÙ‡</option>
                                                    <option value="Ø¥Ø¶Ø§Ø¡Ø©" ${product.category === 'Ø¥Ø¶Ø§Ø¡Ø©' ? 'selected' : ''}>Ø¥Ø¶Ø§Ø¡Ø©</option>
                                                    <option value="Ø£Ø®Ø±Ù‰" ${product.category === 'Ø£Ø®Ø±Ù‰' ? 'selected' : ''}>Ø£Ø®Ø±Ù‰</option>
                                                </select>
                                                <label>ÙØ¦Ø© Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="editProductName" value="${product.name}" required>
                                        <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù *</label>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <textarea class="form-control" id="editProductDescription" style="height: 100px">${product.description || ''}</textarea>
                                        <label>ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬</label>
                                    </div>

                                    <!-- Pricing Section -->
                                    <div class="alert alert-warning">
                                        <h6><i class="fas fa-dollar-sign me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Ù…Ø­Ù„Ùƒ</h6>
                                        <p class="mb-0 small">Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø­Ù„Ùƒ ÙÙ‚Ø·</p>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="editProductPrice" step="0.01" min="0" value="${shopDetail.price}" required>
                                                <label>Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„) *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="editProductQuantity" min="0" value="${shopDetail.quantity}" required>
                                                <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø© *</label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Preview Section -->
                                    <div class="alert alert-info">
                                        <h6><i class="fas fa-eye me-2"></i>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«</h6>
                                        <div id="editProductPreview">
                                            <strong>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</strong> <span id="editPreviewName">${product.name}</span><br>
                                            <strong>Ø§Ù„ÙˆØµÙ:</strong> <span id="editPreviewDescription">${product.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</span><br>
                                            <strong>Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> <span id="editPreviewCar">${currentCarBrand} ${currentCarModel} ${currentCarYear}</span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                                <button type="button" class="btn btn-warning" onclick="updateShopProduct(${productId})">
                                    <i class="fas fa-save me-2"></i>
                                    Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalsContainer').innerHTML = modal;
            const modalElement = new bootstrap.Modal(document.getElementById('editProductModal'));
            modalElement.show();

            // Initialize the form after modal is shown
            setTimeout(() => {
                // Set current car model in dropdown
                updateEditCarModels();
                if (currentCarModel) {
                    const carModelSelect = document.getElementById('editCarModel');
                    if (carModelSelect) {
                        carModelSelect.value = currentCarModel;
                    }
                }

                addEditProductFormListeners();
                updateEditProductPreview();
            }, 100);
        }

        // Quick update product from dashboard
        function quickUpdateProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
            if (!shopDetail) return;

            const priceInput = document.getElementById(`price_${productId}`);
            const quantityInput = document.getElementById(`quantity_${productId}`);
            const totalSpan = document.getElementById(`total_${productId}`);

            if (!priceInput || !quantityInput || !totalSpan) return;

            const newPrice = parseFloat(priceInput.value) || 0;
            const newQuantity = parseInt(quantityInput.value) || 0;

            // Update the product data
            shopDetail.price = newPrice;
            shopDetail.quantity = newQuantity;

            // Update total display
            const total = Math.round(newPrice * newQuantity);
            totalSpan.textContent = `${total} Ø±ÙŠØ§Ù„`;

            // Update card border based on availability
            const card = priceInput.closest('.card');
            const badge = card.querySelector('.badge');

            if (newQuantity > 0) {
                card.classList.remove('border-warning');
                badge.className = 'badge bg-success';
                badge.textContent = 'Ù…ØªÙˆÙØ±';
            } else {
                card.classList.add('border-warning');
                badge.className = 'badge bg-warning text-dark';
                badge.textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            }

            // Save to localStorage
            saveToStorage();

            // Update dashboard statistics
            loadDashboard();

            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« "${product.name}" - Ø§Ù„Ø³Ø¹Ø±: ${newPrice} Ø±ÙŠØ§Ù„ØŒ Ø§Ù„ÙƒÙ…ÙŠØ©: ${newQuantity}`, 'success');
        }

        // Show bulk price update
        function showBulkPriceUpdate() {
            const percentage = prompt('ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©:\n(Ù…Ø«Ø§Ù„: 10 Ù„Ù„Ø²ÙŠØ§Ø¯Ø© 10%ØŒ -5 Ù„Ù„ØªÙ‚Ù„ÙŠÙ„ 5%)', '0');
            if (percentage === null) return;

            const percentageValue = parseFloat(percentage);
            if (isNaN(percentageValue)) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'warning');
                return;
            }

            let updatedCount = 0;
            products.forEach(product => {
                const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                if (shopDetail) {
                    const oldPrice = shopDetail.price;
                    const newPrice = Math.round(oldPrice * (1 + percentageValue / 100) * 100) / 100;
                    shopDetail.price = newPrice;
                    updatedCount++;

                    // Update input if visible
                    const priceInput = document.getElementById(`price_${product.id}`);
                    if (priceInput) {
                        priceInput.value = newPrice;
                        quickUpdateProduct(product.id);
                    }
                }
            });

            saveToStorage();
            loadDashboard();
            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± ${updatedCount} Ù…Ù†ØªØ¬ Ø¨Ù†Ø³Ø¨Ø© ${percentageValue}%`, 'success');
        }

        // Show bulk quantity update
        function showBulkQuantityUpdate() {
            const action = confirm('Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:\nÙ…ÙˆØ§ÙÙ‚ = ØªØ¹ÙŠÙŠÙ† ÙƒÙ…ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª\nØ¥Ù„ØºØ§Ø¡ = Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');

            if (action) {
                // Set specific quantity
                const quantity = prompt('ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', '0');
                if (quantity === null) return;

                const quantityValue = parseInt(quantity);
                if (isNaN(quantityValue) || quantityValue < 0) {
                    showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ 0', 'warning');
                    return;
                }

                let updatedCount = 0;
                products.forEach(product => {
                    const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                    if (shopDetail) {
                        shopDetail.quantity = quantityValue;
                        updatedCount++;

                        // Update input if visible
                        const quantityInput = document.getElementById(`quantity_${product.id}`);
                        if (quantityInput) {
                            quantityInput.value = quantityValue;
                            quickUpdateProduct(product.id);
                        }
                    }
                });

                saveToStorage();
                loadDashboard();
                showNotification(`ØªÙ… ØªØ¹ÙŠÙŠÙ† ÙƒÙ…ÙŠØ© ${quantityValue} Ù„Ù€ ${updatedCount} Ù…Ù†ØªØ¬`, 'success');

            } else {
                // Add quantity
                const quantity = prompt('Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', '0');
                if (quantity === null) return;

                const quantityValue = parseInt(quantity);
                if (isNaN(quantityValue)) {
                    showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'warning');
                    return;
                }

                let updatedCount = 0;
                products.forEach(product => {
                    const shopDetail = product.shopDetails.find(shop => shop.shopId === currentUser.shopId);
                    if (shopDetail) {
                        shopDetail.quantity = Math.max(0, shopDetail.quantity + quantityValue);
                        updatedCount++;

                        // Update input if visible
                        const quantityInput = document.getElementById(`quantity_${product.id}`);
                        if (quantityInput) {
                            quantityInput.value = shopDetail.quantity;
                            quickUpdateProduct(product.id);
                        }
                    }
                });

                saveToStorage();
                loadDashboard();
                showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${quantityValue} Ù„ÙƒÙ…ÙŠØ© ${updatedCount} Ù…Ù†ØªØ¬`, 'success');
            }
        }

        // Show available products only
        function showAvailableProducts() {
            const availableOnly = confirm('Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙ‚Ø· (Ø§Ù„ÙƒÙ…ÙŠØ© > 0)ØŸ');
            if (availableOnly) {
                // Hide products with 0 quantity
                document.querySelectorAll('[id^="quantity_"]').forEach(input => {
                    const card = input.closest('.col-lg-4');
                    if (parseInt(input.value) === 0) {
                        card.style.display = 'none';
                    } else {
                        card.style.display = 'block';
                    }
                });
                showNotification('ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙ‚Ø·', 'info');
            } else {
                // Show all products
                document.querySelectorAll('[id^="quantity_"]').forEach(input => {
                    const card = input.closest('.col-lg-4');
                    card.style.display = 'block';
                });
                showNotification('ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', 'info');
            }
        }

        function removeProductFromShop(productId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ù…Ø­Ù„ÙƒØŸ')) return;

            const product = products.find(p => p.id === productId);
            const shopDetailIndex = product.shopDetails.findIndex(shop => shop.shopId === currentUser.shopId);

            if (shopDetailIndex > -1) {
                product.shopDetails.splice(shopDetailIndex, 1);

                // If no shops have this product, remove it completely
                if (product.shopDetails.length === 0) {
                    const productIndex = products.findIndex(p => p.id === productId);
                    products.splice(productIndex, 1);
                }

                // Save to localStorage
                saveToStorage();

                showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ "${product.name}" Ù…Ù† Ù…Ø­Ù„Ùƒ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                loadDashboard();
            }
        }

        function viewShopProducts(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (!shop) {
                showNotification('Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            // Get shop products
            const shopProducts = products.filter(product =>
                product.shopDetails.some(detail => detail.shopId === shopId)
            );

            // Calculate statistics
            const totalProducts = shopProducts.length;
            const totalValue = shopProducts.reduce((sum, product) => {
                const shopDetail = product.shopDetails.find(detail => detail.shopId === shopId);
                return sum + (shopDetail ? shopDetail.price * shopDetail.quantity : 0);
            }, 0);

            const totalQuantity = shopProducts.reduce((sum, product) => {
                const shopDetail = product.shopDetails.find(detail => detail.shopId === shopId);
                return sum + (shopDetail ? shopDetail.quantity : 0);
            }, 0);

            // Find username for this shop
            let shopUsername = '';
            for (let username in users) {
                if (users[username].shopId === shopId) {
                    shopUsername = username;
                    break;
                }
            }

            const modal = `
                <div class="modal fade" id="viewShopModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-store me-2"></i>
                                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ù„: ${shop.name}
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Shop Info -->
                                <div class="row mb-4">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6><i class="fas fa-info-circle me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„:</h6>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${shop.name}</p>
                                                        <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${shop.description}</p>
                                                        <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${shop.phone}</p>
                                                        <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${shop.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                                        <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${shopUsername}</p>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${shop.address}</p>
                                                        <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${shop.city}</p>
                                                        <p><strong>Ø§Ù„ØªØ®ØµØµ:</strong> ${shop.specialty || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                                                        <p><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${shop.rating} â­</p>
                                                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</strong> ${shop.joinDate}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-primary text-white text-center">
                                            <div class="card-body">
                                                <h4>${totalProducts}</h4>
                                                <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                                            </div>
                                        </div>
                                        <div class="card bg-success text-white text-center mt-2">
                                            <div class="card-body">
                                                <h4>${totalQuantity}</h4>
                                                <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ§Øª</p>
                                            </div>
                                        </div>
                                        <div class="card bg-warning text-white text-center mt-2">
                                            <div class="card-body">
                                                <h4>${Math.round(totalValue)} Ø±ÙŠØ§Ù„</h4>
                                                <p class="mb-0">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Products Table -->
                                <h6><i class="fas fa-box me-2"></i>Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ù„:</h6>
                                ${totalProducts === 0 ? `
                                    <div class="alert alert-info text-center">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­Ù„
                                    </div>
                                ` : `
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                                    <th>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
                                                    <th>Ø§Ù„ÙØ¦Ø©</th>
                                                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                                    <th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${shopProducts.map(product => {
                                                    const shopDetail = product.shopDetails.find(detail => detail.shopId === shopId);
                                                    const productValue = shopDetail.price * shopDetail.quantity;
                                                    const isAvailable = shopDetail.quantity > 0;

                                                    return `
                                                        <tr>
                                                            <td>
                                                                <strong>${product.name}</strong>
                                                                ${product.brand ? `<br><small class="text-muted">${product.brand}</small>` : ''}
                                                            </td>
                                                            <td><code>${product.partNumber || '-'}</code></td>
                                                            <td>
                                                                ${product.category ? `<span class="badge bg-secondary">${product.category}</span>` : '-'}
                                                            </td>
                                                            <td><strong>${shopDetail.price} Ø±ÙŠØ§Ù„</strong></td>
                                                            <td>
                                                                <span class="badge ${isAvailable ? 'bg-success' : 'bg-danger'}">
                                                                    ${shopDetail.quantity}
                                                                </span>
                                                            </td>
                                                            <td><strong>${Math.round(productValue)} Ø±ÙŠØ§Ù„</strong></td>
                                                            <td>
                                                                <span class="badge ${isAvailable ? 'bg-success' : 'bg-danger'}">
                                                                    ${isAvailable ? 'Ù…ØªÙˆÙØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    `;
                                                }).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                `}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                                ${currentUser && currentUser.role === 'admin' ? `
                                    <button type="button" class="btn btn-warning" onclick="editShop(${shopId}); bootstrap.Modal.getInstance(document.getElementById('viewShopModal')).hide();">
                                        <i class="fas fa-edit me-2"></i>
                                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­Ù„
                                    </button>
                                    <button type="button" class="btn btn-danger" onclick="deleteShop(${shopId}); bootstrap.Modal.getInstance(document.getElementById('viewShopModal')).hide();">
                                        <i class="fas fa-trash me-2"></i>
                                        Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalsContainer').innerHTML = modal;
            const modalElement = new bootstrap.Modal(document.getElementById('viewShopModal'));
            modalElement.show();
        }

        function editShop(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (!shop) {
                showNotification('Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            // Find the user for this shop
            let shopUser = null;
            let shopUsername = '';
            for (let username in users) {
                if (users[username].shopId === shopId) {
                    shopUser = users[username];
                    shopUsername = username;
                    break;
                }
            }

            const modal = `
                <div class="modal fade" id="editShopModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-dark">
                                <h5 class="modal-title">
                                    <i class="fas fa-edit me-2"></i>
                                    ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editShopForm">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ù„:</strong> ${shop.id} |
                                        <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</strong> ${shop.joinDate}
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="editShopUsername" value="${shopUsername}" required>
                                                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="password" class="form-control" id="editShopPassword" value="${shopUser ? shopUser.password : ''}" required>
                                                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="editShopName" value="${shop.name}" required>
                                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ *</label>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <textarea class="form-control" id="editShopDescription" style="height: 100px" required>${shop.description}</textarea>
                                        <label>ÙˆØµÙ Ø§Ù„Ù…Ø­Ù„ *</label>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="tel" class="form-control" id="editShopPhone" value="${shop.phone}" required>
                                                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3">
                                                <input type="email" class="form-control" id="editShopEmail" value="${shop.email || ''}">
                                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-floating mb-3">
                                        <input type="text" class="form-control" id="editShopAddress" value="${shop.address}" required>
                                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† *</label>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <select class="form-select" id="editShopCity" required>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                                                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶" ${shop.city === 'Ø§Ù„Ø±ÙŠØ§Ø¶' ? 'selected' : ''}>Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                                                    <option value="Ø¬Ø¯Ø©" ${shop.city === 'Ø¬Ø¯Ø©' ? 'selected' : ''}>Ø¬Ø¯Ø©</option>
                                                    <option value="Ø§Ù„Ø¯Ù…Ø§Ù…" ${shop.city === 'Ø§Ù„Ø¯Ù…Ø§Ù…' ? 'selected' : ''}>Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                                                    <option value="Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©" ${shop.city === 'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©' ? 'selected' : ''}>Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                                                    <option value="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©" ${shop.city === 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©' ? 'selected' : ''}>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</option>
                                                </select>
                                                <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <input type="text" class="form-control" id="editShopSpecialty" value="${shop.specialty || ''}">
                                                <label>Ø§Ù„ØªØ®ØµØµ</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-floating mb-3">
                                                <input type="number" class="form-control" id="editShopRating" value="${shop.rating}" min="0" max="5" step="0.1">
                                                <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… (0-5)</label>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                                <button type="button" class="btn btn-warning" onclick="updateShop(${shopId}, '${shopUsername}')">
                                    <i class="fas fa-save me-2"></i>
                                    Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('modalsContainer').innerHTML = modal;
            const modalElement = new bootstrap.Modal(document.getElementById('editShopModal'));
            modalElement.show();
        }

        // Update shop
        function updateShop(shopId, oldUsername) {
            const shopData = {
                username: document.getElementById('editShopUsername').value.trim(),
                password: document.getElementById('editShopPassword').value.trim(),
                name: document.getElementById('editShopName').value.trim(),
                description: document.getElementById('editShopDescription').value.trim(),
                phone: document.getElementById('editShopPhone').value.trim(),
                email: document.getElementById('editShopEmail').value.trim(),
                address: document.getElementById('editShopAddress').value.trim(),
                city: document.getElementById('editShopCity').value,
                specialty: document.getElementById('editShopSpecialty').value.trim(),
                rating: parseFloat(document.getElementById('editShopRating').value) || 0
            };

            // Validation
            if (!shopData.username || !shopData.password || !shopData.name || !shopData.description ||
                !shopData.phone || !shopData.address || !shopData.city) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'warning');
                return;
            }

            // Check if new username exists (if changed)
            if (shopData.username !== oldUsername && users[shopData.username]) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'warning');
                return;
            }

            // Check if new shop name exists (if changed)
            const existingShop = shops.find(shop => shop.id !== shopId && shop.name.toLowerCase() === shopData.name.toLowerCase());
            if (existingShop) {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'warning');
                return;
            }

            // Find and update shop
            const shopIndex = shops.findIndex(shop => shop.id === shopId);
            if (shopIndex === -1) {
                showNotification('Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            // Update shop data
            shops[shopIndex] = {
                ...shops[shopIndex],
                name: shopData.name,
                description: shopData.description,
                phone: shopData.phone,
                email: shopData.email,
                address: shopData.address,
                city: shopData.city,
                specialty: shopData.specialty,
                rating: shopData.rating
            };

            // Update user data
            if (oldUsername !== shopData.username) {
                // Remove old username
                delete users[oldUsername];

                // Add new username
                users[shopData.username] = {
                    password: shopData.password,
                    role: 'shop',
                    name: shopData.name,
                    shopId: shopId
                };
            } else {
                // Update existing user
                users[shopData.username] = {
                    ...users[shopData.username],
                    password: shopData.password,
                    name: shopData.name
                };
            }

            // Update product shop details with new shop name
            products.forEach(product => {
                product.shopDetails.forEach(shopDetail => {
                    if (shopDetail.shopId === shopId) {
                        shopDetail.shopName = shopData.name;
                    }
                });
            });

            // Save to localStorage
            saveToStorage();

            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('editShopModal')).hide();

            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ "${shopData.name}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');

            if (oldUsername !== shopData.username) {
                setTimeout(() => {
                    showNotification(`Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${shopData.username} / ${shopData.password}`, 'info');
                }, 1000);
            }

            // Refresh shops page if currently viewing
            if (document.getElementById('shops').classList.contains('active')) {
                loadShops();
            }

            // Refresh home page data
            if (document.getElementById('home').classList.contains('active')) {
                loadData();
            }

            // Update current user if editing own shop
            if (currentUser && currentUser.shopId === shopId) {
                currentUser.name = shopData.name;
                if (oldUsername !== shopData.username) {
                    currentUser.username = shopData.username;
                }
                document.getElementById('userWelcome').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}`;
            }
        }

        function deleteShop(shopId) {
            const shop = shops.find(s => s.id === shopId);
            if (!shop) {
                showNotification('Ø§Ù„Ù…Ø­Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'danger');
                return;
            }

            // Count products that will be affected
            const shopProducts = products.filter(product =>
                product.shopDetails.some(detail => detail.shopId === shopId)
            );

            const productsToDelete = products.filter(product =>
                product.shopDetails.length === 1 && product.shopDetails[0].shopId === shopId
            );

            // Find username for this shop
            let shopUsername = '';
            for (let username in users) {
                if (users[username].shopId === shopId) {
                    shopUsername = username;
                    break;
                }
            }

            // Show detailed confirmation
            const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ "${shop.name}"ØŸ\n\n` +
                `Ø³ÙŠØªÙ… Ø­Ø°Ù:\n` +
                `â€¢ Ø§Ù„Ù…Ø­Ù„ ÙˆØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡\n` +
                `â€¢ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${shopUsername}"\n` +
                `â€¢ ${shopProducts.length} Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø­Ù„\n` +
                `â€¢ ${productsToDelete.length} Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ù…Ø­Ù„Ø§Øª Ø£Ø®Ø±Ù‰)\n\n` +
                `Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`;

            if (!confirm(confirmMessage)) return;

            const shopIndex = shops.findIndex(s => s.id === shopId);
            if (shopIndex > -1) {
                const shopName = shops[shopIndex].name;
                let deletedProductsCount = 0;
                let removedProductsCount = 0;

                // Remove shop products and count deletions
                products.forEach(product => {
                    const initialLength = product.shopDetails.length;
                    product.shopDetails = product.shopDetails.filter(shop => shop.shopId !== shopId);

                    if (product.shopDetails.length < initialLength) {
                        removedProductsCount++;
                    }
                });

                // Remove empty products and count deletions
                for (let i = products.length - 1; i >= 0; i--) {
                    if (products[i].shopDetails.length === 0) {
                        products.splice(i, 1);
                        deletedProductsCount++;
                    }
                }

                // Remove shop
                shops.splice(shopIndex, 1);

                // Remove user
                let deletedUsername = '';
                for (let username in users) {
                    if (users[username].shopId === shopId) {
                        deletedUsername = username;
                        delete users[username];
                        break;
                    }
                }

                // Save to localStorage
                saveToStorage();

                // Show detailed success message
                showNotification(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ù„ "${shopName}" Ø¨Ù†Ø¬Ø§Ø­!`, 'success');

                setTimeout(() => {
                    showNotification(
                        `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø°Ù: Ø­ÙØ°Ù ${deletedProductsCount} Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŒ ÙˆØ£ÙØ²ÙŠÙ„ ${removedProductsCount} Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù…Ø­Ù„ØŒ ÙˆØ­ÙØ°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${deletedUsername}"`,
                        'info'
                    );
                }, 1000);

                // Refresh current page
                if (document.getElementById('shops').classList.contains('active')) {
                    loadShops();
                }

                // Refresh home page data if viewing
                if (document.getElementById('home').classList.contains('active')) {
                    loadData();
                }

                // Logout if current user's shop was deleted
                if (currentUser && currentUser.shopId === shopId) {
                    logout();
                    showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ù„Ø£Ù† Ù…Ø­Ù„Ùƒ Ù‚Ø¯ Ø­ÙØ°Ù', 'warning');
                }
            }
        }

        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            const updateTimeElement = document.getElementById('updateTime');
            if (updateTimeElement) {
                updateTimeElement.textContent = timeString;
            }
        }

        // Force refresh data immediately
        function forceRefreshData() {
            console.log('âš¡ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

            // Show loading indicator
            const statusElement = document.getElementById('dataStatus');
            if (statusElement) {
                statusElement.className = 'badge bg-warning me-2';
                statusElement.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>ÙŠØ­Ø¯Ø«...';
            }

            // Reload data from localStorage
            loadFromStorage();

            // Update current page
            const currentPage = document.querySelector('.page-content.active');
            if (currentPage) {
                const pageId = currentPage.id;
                if (pageId === 'home') {
                    loadData();
                    console.log('ğŸ  ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙˆØ±ÙŠØ§Ù‹');
                } else if (pageId === 'shops') {
                    loadShops();
                    console.log('ğŸª ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª ÙÙˆØ±ÙŠØ§Ù‹');
                } else if (pageId === 'dashboard') {
                    loadDashboard();
                    console.log('ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙˆØ±ÙŠØ§Ù‹');
                }
            }

            // Update summary
            updateSummaryCards();

            // Update time
            updateLastUpdateTime();

            // Show success status
            setTimeout(() => {
                if (statusElement) {
                    statusElement.className = 'badge bg-success me-2';
                    statusElement.innerHTML = '<i class="fas fa-check me-1"></i>Ù…Ø­Ø¯Ø«';
                }
            }, 500);

            // Show notification
            const dataCount = `Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${shops.length}, Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products.length}`;
            showNotification(`ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ! ${dataCount}`, 'success');
            console.log(`âš¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ Ù…ÙƒØªÙ…Ù„: ${dataCount}`);
        }

        // Auto-refresh data periodically
        function autoRefreshData() {
            console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

            // Reload data from localStorage
            loadFromStorage();

            // Update current page
            const currentPage = document.querySelector('.page-content.active');
            if (currentPage) {
                const pageId = currentPage.id;
                if (pageId === 'home') {
                    loadData();
                    console.log('ğŸ  ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
                } else if (pageId === 'shops') {
                    loadShops();
                    console.log('ğŸª ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ù„Ø§Øª');
                } else if (pageId === 'dashboard') {
                    loadDashboard();
                    console.log('ğŸ“Š ØªÙ… ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
                }
            }

            // Update summary
            updateSummaryCards();

            // Update time
            updateLastUpdateTime();

            // Show subtle notification
            const dataCount = `Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${shops.length}, Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products.length}`;
            console.log(`ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹: ${dataCount}`);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');

            // Initialize data from localStorage
            initializeData();
            console.log('ğŸ’¾ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');

            // Add form event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);

            // Add search event listeners for real-time search with independent search
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                console.log('ğŸ”— Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ');
                searchInput.addEventListener('input', function() {
                    const value = this.value.trim();
                    if (value) {
                        clearOtherSearches('text');
                    }
                    // Perform search after a short delay to avoid too many calls
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => {
                        performSearch();
                    }, 300);
                });

                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const value = this.value.trim();
                        if (value) {
                            clearOtherSearches('text');
                        }
                        performSearch();
                    }
                });
            }

            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                console.log('ğŸ”— Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ ÙÙ„ØªØ± Ø§Ù„ÙØ¦Ø©');
                categoryFilter.addEventListener('change', function() {
                    if (this.value) {
                        clearOtherSearches('category');
                    }
                    performSearch();
                });
            }

            const brandFilter = document.getElementById('brandFilter');
            if (brandFilter) {
                brandFilter.addEventListener('change', function() {
                    loadModels();
                    performSearch();
                });
            }

            const modelFilter = document.getElementById('modelFilter');
            if (modelFilter) {
                modelFilter.addEventListener('change', function() {
                    performSearch();
                });
            }

            // Add event listeners for new search fields with independent search
            const partNumberSearch = document.getElementById('partNumberSearch');
            if (partNumberSearch) {
                console.log('ğŸ”— Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©');
                partNumberSearch.addEventListener('input', function() {
                    const value = this.value.trim();
                    if (value) {
                        clearOtherSearches('partNumber');
                    }
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => {
                        performSearch();
                    }, 300);
                });

                partNumberSearch.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const value = this.value.trim();
                        if (value) {
                            clearOtherSearches('partNumber');
                        }
                        performSearch();
                    }
                });
            }

            const carBrandSearch = document.getElementById('carBrandSearch');
            if (carBrandSearch) {
                console.log('ğŸ”— Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
                carBrandSearch.addEventListener('change', function() {
                    if (this.value) {
                        clearOtherSearches('car');
                    }
                    updateSearchCarModels();
                    performSearch();
                });
            }

            const carModelSearch = document.getElementById('carModelSearch');
            if (carModelSearch) {
                console.log('ğŸ”— Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
                carModelSearch.addEventListener('change', function() {
                    if (this.value) {
                        clearOtherSearches('car');
                    }
                    performSearch();
                });
            }

            const carYearSearch = document.getElementById('carYearSearch');
            if (carYearSearch) {
                console.log('ğŸ”— Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø¨Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©');
                carYearSearch.addEventListener('change', function() {
                    if (this.value) {
                        clearOtherSearches('car');
                    }
                    performSearch();
                });
            }

            // Force show home page and load data immediately
            showPage('home');
            console.log('ğŸ  ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');

            // Load initial data with delay to ensure DOM is ready
            setTimeout(() => {
                loadData();
                updateLastUpdateTime();
                console.log('ğŸ“Š ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©');

                // Show welcome message
                const dataCount = `Ø§Ù„Ù…Ø­Ù„Ø§Øª: ${shops.length}, Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${products.length}`;
                showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (${dataCount})`, 'success');
            }, 100);

            // Set up auto-refresh every 30 seconds
            setInterval(autoRefreshData, 30000);
            console.log('â° ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©');

            // Set up visibility change listener to refresh when tab becomes active
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    console.log('ğŸ‘ï¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£ØµØ¨Ø­ Ù…Ø±Ø¦ÙŠØ§Ù‹ - ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                    setTimeout(autoRefreshData, 500);
                }
            });

            // Test search functionality
            setTimeout(() => {
                testSearchFunctionality();
            }, 1000);

            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
        });
    </script>
</body>
</html>
